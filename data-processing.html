<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Processing data | Introduction to R</title>
  <meta name="description" content="This is the material for the course Introduction to R, given at Karolinska Institutet, Stockholm, Sweden, as part of the doctoral program in epidemiology." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Processing data | Introduction to R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the material for the course Introduction to R, given at Karolinska Institutet, Stockholm, Sweden, as part of the doctoral program in epidemiology." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Processing data | Introduction to R" />
  
  <meta name="twitter:description" content="This is the material for the course Introduction to R, given at Karolinska Institutet, Stockholm, Sweden, as part of the doctoral program in epidemiology." />
  



<meta name="date" content="2023-03-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-types-struct.html"/>
<link rel="next" href="data-tidyverse.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this document</a></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="1" data-path="background.html"><a href="background.html"><i class="fa fa-check"></i><b>1</b> Background</a>
<ul>
<li class="chapter" data-level="1.1" data-path="background.html"><a href="background.html#what-is-r"><i class="fa fa-check"></i><b>1.1</b> What is R?</a></li>
<li class="chapter" data-level="1.2" data-path="background.html"><a href="background.html#what-is-rstudio"><i class="fa fa-check"></i><b>1.2</b> What is RStudio?</a></li>
<li class="chapter" data-level="1.3" data-path="background.html"><a href="background.html#software-installation"><i class="fa fa-check"></i><b>1.3</b> Software installation</a></li>
<li class="chapter" data-level="1.4" data-path="background.html"><a href="background.html#references"><i class="fa fa-check"></i><b>1.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Working with R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#starting-r"><i class="fa fa-check"></i><b>2.1</b> Starting R</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#storing-data-as-objects"><i class="fa fa-check"></i><b>2.2</b> Storing data as objects</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction.html"><a href="introduction.html#about-variable-names"><i class="fa fa-check"></i><b>2.2.1</b> About variable names</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#data-structure-i-the-vector"><i class="fa fa-check"></i><b>2.3</b> Data structure I: The vector</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction.html"><a href="introduction.html#ex-simple-desc"><i class="fa fa-check"></i><b>2.3.1</b> Example: simple descriptives</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction.html"><a href="introduction.html#ex-simple-plots"><i class="fa fa-check"></i><b>2.3.2</b> Example: simple plots</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#non-numeric-data"><i class="fa fa-check"></i><b>2.4</b> Non-numeric data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introduction.html"><a href="introduction.html#descriptives-for-grouping-data"><i class="fa fa-check"></i><b>2.4.1</b> Descriptives for grouping data</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction.html"><a href="introduction.html#character-vector-vs-factor"><i class="fa fa-check"></i><b>2.4.2</b> Character vector vs factor</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#general-data-in-r"><i class="fa fa-check"></i><b>2.5</b> General data in R</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introduction.html"><a href="introduction.html#extracting-parts-of-a-data-frame"><i class="fa fa-check"></i><b>2.5.1</b> Extracting parts of a data frame</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction.html"><a href="introduction.html#ex_desc_stats"><i class="fa fa-check"></i><b>2.5.2</b> Example: descriptive statistics</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#meta-activity"><i class="fa fa-check"></i><b>2.6</b> Meta-activity</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>2.6.1</b> Getting help</a></li>
<li class="chapter" data-level="2.6.2" data-path="introduction.html"><a href="introduction.html#keeping-track-of-objects"><i class="fa fa-check"></i><b>2.6.2</b> Keeping track of objects</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="introduction.html"><a href="introduction.html#finding-files"><i class="fa fa-check"></i><b>2.7</b> Finding files</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="introduction.html"><a href="introduction.html#quitting-r"><i class="fa fa-check"></i><b>2.7.1</b> Quitting R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intro_rstudio.html"><a href="intro_rstudio.html"><i class="fa fa-check"></i><b>3</b> Working in RStudio</a>
<ul>
<li class="chapter" data-level="3.1" data-path="intro_rstudio.html"><a href="intro_rstudio.html#getting-started"><i class="fa fa-check"></i><b>3.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2" data-path="intro_rstudio.html"><a href="intro_rstudio.html#a-quick-tour-of-the-gui"><i class="fa fa-check"></i><b>3.2</b> A quick tour of the GUI</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="intro_rstudio.html"><a href="intro_rstudio.html#console-and-friends"><i class="fa fa-check"></i><b>3.2.1</b> Console and friends</a></li>
<li class="chapter" data-level="3.2.2" data-path="intro_rstudio.html"><a href="intro_rstudio.html#rstudio-console-specials"><i class="fa fa-check"></i><b>3.2.2</b> RStudio Console specials</a></li>
<li class="chapter" data-level="3.2.3" data-path="intro_rstudio.html"><a href="intro_rstudio.html#navigating-the-pane-layout"><i class="fa fa-check"></i><b>3.2.3</b> Navigating the pane layout</a></li>
<li class="chapter" data-level="3.2.4" data-path="intro_rstudio.html"><a href="intro_rstudio.html#the-default-upper-pane"><i class="fa fa-check"></i><b>3.2.4</b> The default upper pane</a></li>
<li class="chapter" data-level="3.2.5" data-path="intro_rstudio.html"><a href="intro_rstudio.html#def-lower-pane"><i class="fa fa-check"></i><b>3.2.5</b> The default lower pane</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="intro_rstudio.html"><a href="intro_rstudio.html#source-pane-scripting"><i class="fa fa-check"></i><b>3.3</b> Source pane &amp; scripting</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="intro_rstudio.html"><a href="intro_rstudio.html#console2source"><i class="fa fa-check"></i><b>3.3.1</b> From console to source</a></li>
<li class="chapter" data-level="3.3.2" data-path="intro_rstudio.html"><a href="intro_rstudio.html#the-source-pane-file-editor"><i class="fa fa-check"></i><b>3.3.2</b> The Source pane file editor</a></li>
<li class="chapter" data-level="3.3.3" data-path="intro_rstudio.html"><a href="intro_rstudio.html#displays"><i class="fa fa-check"></i><b>3.3.3</b> Displays</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="intro-example.html"><a href="intro-example.html"><i class="fa fa-check"></i><b>4</b> A simple example</a>
<ul>
<li class="chapter" data-level="4.1" data-path="intro-example.html"><a href="intro-example.html#intro-ex-import"><i class="fa fa-check"></i><b>4.1</b> Data import</a></li>
<li class="chapter" data-level="4.2" data-path="intro-example.html"><a href="intro-example.html#analysis"><i class="fa fa-check"></i><b>4.2</b> Analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="intro-example.html"><a href="intro-example.html#desc-ex"><i class="fa fa-check"></i><b>4.2.1</b> Descriptives</a></li>
<li class="chapter" data-level="4.2.2" data-path="intro-example.html"><a href="intro-example.html#blood-pressure-by-salt-intake"><i class="fa fa-check"></i><b>4.2.2</b> Blood pressure by salt intake</a></li>
<li class="chapter" data-level="4.2.3" data-path="intro-example.html"><a href="intro-example.html#salt-intake-by-sex"><i class="fa fa-check"></i><b>4.2.3</b> Salt intake by sex</a></li>
<li class="chapter" data-level="4.2.4" data-path="intro-example.html"><a href="intro-example.html#save-results"><i class="fa fa-check"></i><b>4.2.4</b> Save results</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="intro-example.html"><a href="intro-example.html#turning-into-script"><i class="fa fa-check"></i><b>4.3</b> Turning it into a script</a></li>
<li class="chapter" data-level="4.4" data-path="intro-example.html"><a href="intro-example.html#exp-res"><i class="fa fa-check"></i><b>4.4</b> Exporting results</a></li>
</ul></li>
<li class="part"><span><b>II Working with data</b></span></li>
<li class="chapter" data-level="5" data-path="data-types-struct.html"><a href="data-types-struct.html"><i class="fa fa-check"></i><b>5</b> Data types and structures</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-types-struct.html"><a href="data-types-struct.html#overview"><i class="fa fa-check"></i><b>5.1</b> Overview</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-types-struct.html"><a href="data-types-struct.html#data-examples"><i class="fa fa-check"></i><b>5.1.1</b> Data examples</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-types-struct.html"><a href="data-types-struct.html#background-1"><i class="fa fa-check"></i><b>5.2</b> Background</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-types-struct.html"><a href="data-types-struct.html#recap"><i class="fa fa-check"></i><b>5.2.1</b> Recap</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-types-struct.html"><a href="data-types-struct.html#motivation"><i class="fa fa-check"></i><b>5.2.2</b> Motivation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-types-struct.html"><a href="data-types-struct.html#more-about-vectors"><i class="fa fa-check"></i><b>5.3</b> More about vectors</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="data-types-struct.html"><a href="data-types-struct.html#vector-calculations"><i class="fa fa-check"></i><b>5.3.1</b> Vector calculations</a></li>
<li class="chapter" data-level="5.3.2" data-path="data-types-struct.html"><a href="data-types-struct.html#indexing-vectors-by-position"><i class="fa fa-check"></i><b>5.3.2</b> Indexing vectors by position</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="data-types-struct.html"><a href="data-types-struct.html#logical-data"><i class="fa fa-check"></i><b>5.4</b> Logical data</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-types-struct.html"><a href="data-types-struct.html#definition"><i class="fa fa-check"></i><b>5.4.1</b> Definition</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-types-struct.html"><a href="data-types-struct.html#logical-expressions"><i class="fa fa-check"></i><b>5.4.2</b> Logical expressions</a></li>
<li class="chapter" data-level="5.4.3" data-path="data-types-struct.html"><a href="data-types-struct.html#logical-vectors"><i class="fa fa-check"></i><b>5.4.3</b> Logical vectors</a></li>
<li class="chapter" data-level="5.4.4" data-path="data-types-struct.html"><a href="data-types-struct.html#logical-vectors-for-indexing"><i class="fa fa-check"></i><b>5.4.4</b> Logical vectors for indexing</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-types-struct.html"><a href="data-types-struct.html#more-on-rectangular-data"><i class="fa fa-check"></i><b>5.5</b> More on rectangular data</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-types-struct.html"><a href="data-types-struct.html#data-frame"><i class="fa fa-check"></i><b>5.5.1</b> Data frame</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-types-struct.html"><a href="data-types-struct.html#matrix"><i class="fa fa-check"></i><b>5.5.2</b> Matrix</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-types-struct.html"><a href="data-types-struct.html#extensions-alternatives"><i class="fa fa-check"></i><b>5.5.3</b> Extensions &amp; alternatives</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="data-types-struct.html"><a href="data-types-struct.html#helpers-subset-and-transform"><i class="fa fa-check"></i><b>5.6</b> Helpers: <code>subset</code> and <code>transform</code></a></li>
<li class="chapter" data-level="5.7" data-path="data-types-struct.html"><a href="data-types-struct.html#list-struct"><i class="fa fa-check"></i><b>5.7</b> Free-style data: lists</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="data-types-struct.html"><a href="data-types-struct.html#background-2"><i class="fa fa-check"></i><b>5.7.1</b> Background</a></li>
<li class="chapter" data-level="5.7.2" data-path="data-types-struct.html"><a href="data-types-struct.html#basic_lists"><i class="fa fa-check"></i><b>5.7.2</b> Basic list</a></li>
<li class="chapter" data-level="5.7.3" data-path="data-types-struct.html"><a href="data-types-struct.html#named_lists"><i class="fa fa-check"></i><b>5.7.3</b> Named lists</a></li>
<li class="chapter" data-level="5.7.4" data-path="data-types-struct.html"><a href="data-types-struct.html#example-data-frames"><i class="fa fa-check"></i><b>5.7.4</b> Example: data frames</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>6</b> Processing data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-processing.html"><a href="data-processing.html#overview-1"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="data-processing.html"><a href="data-processing.html#group-stats"><i class="fa fa-check"></i><b>6.2</b> Groupwise statistics</a></li>
<li class="chapter" data-level="6.3" data-path="data-processing.html"><a href="data-processing.html#own-functions"><i class="fa fa-check"></i><b>6.3</b> Using your own functions</a></li>
<li class="chapter" data-level="6.4" data-path="data-processing.html"><a href="data-processing.html#split-apply-combine"><i class="fa fa-check"></i><b>6.4</b> Split - Apply - Combine</a></li>
<li class="chapter" data-level="6.5" data-path="data-processing.html"><a href="data-processing.html#merge-data-base"><i class="fa fa-check"></i><b>6.5</b> Merging data sets</a></li>
<li class="chapter" data-level="6.6" data-path="data-processing.html"><a href="data-processing.html#general-pipeline"><i class="fa fa-check"></i><b>6.6</b> Using pipelines</a></li>
<li class="chapter" data-level="6.7" data-path="data-processing.html"><a href="data-processing.html#next-steps"><i class="fa fa-check"></i><b>6.7</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-tidyverse.html"><a href="data-tidyverse.html"><i class="fa fa-check"></i><b>7</b> The <code>tidyverse</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-tidyverse.html"><a href="data-tidyverse.html#overview-2"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="data-tidyverse.html"><a href="data-tidyverse.html#example-using-dplyr-for-data-processing"><i class="fa fa-check"></i><b>7.2</b> Example: Using <code>dplyr</code> for data processing</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="data-tidyverse.html"><a href="data-tidyverse.html#overview-3"><i class="fa fa-check"></i><b>7.2.1</b> Overview</a></li>
<li class="chapter" data-level="7.2.2" data-path="data-tidyverse.html"><a href="data-tidyverse.html#basic-data-operations"><i class="fa fa-check"></i><b>7.2.2</b> Basic data operations</a></li>
<li class="chapter" data-level="7.2.3" data-path="data-tidyverse.html"><a href="data-tidyverse.html#groupwise-data-operations"><i class="fa fa-check"></i><b>7.2.3</b> Groupwise data operations</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="data-tidyverse.html"><a href="data-tidyverse.html#tidyverse-vs-base-r"><i class="fa fa-check"></i><b>7.3</b> <code>tidyverse</code> vs base R?</a></li>
</ul></li>
<li class="part"><span><b>III Estimation, inference, modelling</b></span></li>
<li class="chapter" data-level="8" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html"><i class="fa fa-check"></i><b>8</b> Basic Statistics &amp; Epidemiology</a>
<ul>
<li class="chapter" data-level="8.1" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#descriptives"><i class="fa fa-check"></i><b>8.1</b> Descriptive statistics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#base-desc"><i class="fa fa-check"></i><b>8.1.1</b> In base R</a></li>
<li class="chapter" data-level="8.1.2" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#using-package-summarytools"><i class="fa fa-check"></i><b>8.1.2</b> Using package <code>summarytools</code></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#confidence-intervals"><i class="fa fa-check"></i><b>8.2</b> Confidence intervals</a></li>
<li class="chapter" data-level="8.3" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#statistical-tests"><i class="fa fa-check"></i><b>8.3</b> Statistical tests</a></li>
<li class="chapter" data-level="8.4" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#epidemiological-risk-measures"><i class="fa fa-check"></i><b>8.4</b> Epidemiological risk measures</a></li>
<li class="chapter" data-level="8.5" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#pander-intro"><i class="fa fa-check"></i><b>8.5</b> Improved display of descriptives</a></li>
<li class="chapter" data-level="8.6" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#next-steps-1"><i class="fa fa-check"></i><b>8.6</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="regression-linear.html"><a href="regression-linear.html"><i class="fa fa-check"></i><b>9</b> Linear regression</a>
<ul>
<li class="chapter" data-level="9.1" data-path="regression-linear.html"><a href="regression-linear.html#overview-4"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="regression-linear.html"><a href="regression-linear.html#background-3"><i class="fa fa-check"></i><b>9.2</b> Background</a></li>
<li class="chapter" data-level="9.3" data-path="regression-linear.html"><a href="regression-linear.html#simple-linear-regression"><i class="fa fa-check"></i><b>9.3</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="regression-linear.html"><a href="regression-linear.html#scatter-loess"><i class="fa fa-check"></i><b>9.3.1</b> Looking at the data</a></li>
<li class="chapter" data-level="9.3.2" data-path="regression-linear.html"><a href="regression-linear.html#fitting-a-linear-regression-model"><i class="fa fa-check"></i><b>9.3.2</b> Fitting a linear regression model</a></li>
<li class="chapter" data-level="9.3.3" data-path="regression-linear.html"><a href="regression-linear.html#regression-table-and-inference"><i class="fa fa-check"></i><b>9.3.3</b> Regression table and inference</a></li>
<li class="chapter" data-level="9.3.4" data-path="regression-linear.html"><a href="regression-linear.html#prediction"><i class="fa fa-check"></i><b>9.3.4</b> Prediction</a></li>
<li class="chapter" data-level="9.3.5" data-path="regression-linear.html"><a href="regression-linear.html#diagnostics"><i class="fa fa-check"></i><b>9.3.5</b> Diagnostics</a></li>
<li class="chapter" data-level="9.3.6" data-path="regression-linear.html"><a href="regression-linear.html#binary-predictor-and-dummy-coding"><i class="fa fa-check"></i><b>9.3.6</b> Binary predictor and dummy coding</a></li>
<li class="chapter" data-level="9.3.7" data-path="regression-linear.html"><a href="regression-linear.html#nicer-regression-tables"><i class="fa fa-check"></i><b>9.3.7</b> Nicer regression tables</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="regression-linear.html"><a href="regression-linear.html#multiple-linear-regression"><i class="fa fa-check"></i><b>9.4</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="regression-linear.html"><a href="regression-linear.html#multiple-predictors"><i class="fa fa-check"></i><b>9.4.1</b> Multiple predictors</a></li>
<li class="chapter" data-level="9.4.2" data-path="regression-linear.html"><a href="regression-linear.html#categorical-predictors-with-2-levels"><i class="fa fa-check"></i><b>9.4.2</b> Categorical predictors with <span class="math inline">\(&gt;\)</span> 2 levels</a></li>
<li class="chapter" data-level="9.4.3" data-path="regression-linear.html"><a href="regression-linear.html#interactions"><i class="fa fa-check"></i><b>9.4.3</b> Interactions</a></li>
<li class="chapter" data-level="9.4.4" data-path="regression-linear.html"><a href="regression-linear.html#splines"><i class="fa fa-check"></i><b>9.4.4</b> Splines</a></li>
<li class="chapter" data-level="9.4.5" data-path="regression-linear.html"><a href="regression-linear.html#model-comparisons"><i class="fa fa-check"></i><b>9.4.5</b> Model comparisons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="regression-other.html"><a href="regression-other.html"><i class="fa fa-check"></i><b>10</b> More regression models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="regression-other.html"><a href="regression-other.html#logistic-regression"><i class="fa fa-check"></i><b>10.1</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="regression-other.html"><a href="regression-other.html#ex.-birthweight-uterine-irritability"><i class="fa fa-check"></i><b>10.1.1</b> Ex.: Birthweight &amp; uterine irritability</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="regression-other.html"><a href="regression-other.html#survival-regression"><i class="fa fa-check"></i><b>10.2</b> Survival regression</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="regression-other.html"><a href="regression-other.html#survival-data"><i class="fa fa-check"></i><b>10.2.1</b> Survival data</a></li>
<li class="chapter" data-level="10.2.2" data-path="regression-other.html"><a href="regression-other.html#survival-curves"><i class="fa fa-check"></i><b>10.2.2</b> Survival curves</a></li>
<li class="chapter" data-level="10.2.3" data-path="regression-other.html"><a href="regression-other.html#cox-regression"><i class="fa fa-check"></i><b>10.2.3</b> Cox regression</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="regression-other.html"><a href="regression-other.html#other-models"><i class="fa fa-check"></i><b>10.3</b> Other models</a></li>
</ul></li>
<li class="part"><span><b>IV Graphics</b></span></li>
<li class="chapter" data-level="11" data-path="graphics-base.html"><a href="graphics-base.html"><i class="fa fa-check"></i><b>11</b> Graphics in base R</a>
<ul>
<li class="chapter" data-level="11.1" data-path="graphics-base.html"><a href="graphics-base.html#overview-5"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="graphics-base.html"><a href="graphics-base.html#base-plots-base-plots"><i class="fa fa-check"></i><b>11.2</b> Base plots</a></li>
<li class="chapter" data-level="11.3" data-path="graphics-base.html"><a href="graphics-base.html#graphical-parameters"><i class="fa fa-check"></i><b>11.3</b> Graphical parameters</a>
<ul>
<li class="chapter" data-level="" data-path="graphics-base.html"><a href="graphics-base.html#vectorized-graphical-parameters"><i class="fa fa-check"></i>Vectorized graphical parameters</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="graphics-base.html"><a href="graphics-base.html#displaying-and-saving-plots"><i class="fa fa-check"></i><b>11.4</b> Displaying and saving plots</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="graphics-base.html"><a href="graphics-base.html#device-par"><i class="fa fa-check"></i><b>11.4.1</b> Controlling a device through <code>par</code></a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="graphics-base.html"><a href="graphics-base.html#high-low-plots"><i class="fa fa-check"></i><b>11.5</b> High- vs. low-level plotting</a></li>
<li class="chapter" data-level="11.6" data-path="graphics-base.html"><a href="graphics-base.html#using-colors"><i class="fa fa-check"></i><b>11.6</b> Using colors</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="graphics-base.html"><a href="graphics-base.html#specifying-colors-by-name"><i class="fa fa-check"></i><b>11.6.1</b> Specifying colors by name</a></li>
<li class="chapter" data-level="11.6.2" data-path="graphics-base.html"><a href="graphics-base.html#specifying-colors-mathematically"><i class="fa fa-check"></i><b>11.6.2</b> Specifying colors mathematically</a></li>
<li class="chapter" data-level="11.6.3" data-path="graphics-base.html"><a href="graphics-base.html#using-sets-of-colors-palettes"><i class="fa fa-check"></i><b>11.6.3</b> Using sets of colors: palettes</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="graphics-base.html"><a href="graphics-base.html#next-steps-2"><i class="fa fa-check"></i><b>11.7</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html"><i class="fa fa-check"></i><b>12</b> Graphics using <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="12.1" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#overview-6"><i class="fa fa-check"></i><b>12.1</b> Overview</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#data-example-hemoglobin"><i class="fa fa-check"></i><b>12.1.1</b> Data example: Hemoglobin</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#background-4"><i class="fa fa-check"></i><b>12.2</b> Background</a></li>
<li class="chapter" data-level="12.3" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#concepts"><i class="fa fa-check"></i><b>12.3</b> Concepts</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#aesthetics"><i class="fa fa-check"></i><b>12.3.1</b> Aesthetics</a></li>
<li class="chapter" data-level="12.3.2" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#example-data"><i class="fa fa-check"></i><b>12.3.2</b> Example data</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#background-5"><i class="fa fa-check"></i><b>12.4</b> Background</a></li>
<li class="chapter" data-level="12.5" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#basic-usage"><i class="fa fa-check"></i><b>12.5</b> Basic usage</a></li>
<li class="chapter" data-level="12.6" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#slightly-extended-usage"><i class="fa fa-check"></i><b>12.6</b> Slightly extended usage</a></li>
<li class="chapter" data-level="12.7" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#multiple-layers"><i class="fa fa-check"></i><b>12.7</b> Multiple layers</a></li>
<li class="chapter" data-level="12.8" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#splitting-the-plot"><i class="fa fa-check"></i><b>12.8</b> Splitting the plot</a></li>
<li class="chapter" data-level="12.9" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#messing-with-the-defaults"><i class="fa fa-check"></i><b>12.9</b> Messing with the defaults</a>
<ul>
<li class="chapter" data-level="12.9.1" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#fixing-aesthetics"><i class="fa fa-check"></i><b>12.9.1</b> {-} Fixing aesthetics</a></li>
<li class="chapter" data-level="" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#scales"><i class="fa fa-check"></i>Scales</a></li>
</ul></li>
<li class="chapter" data-level="12.10" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#messing-with-defaults-ii-themes"><i class="fa fa-check"></i><b>12.10</b> Messing with defaults II: themes</a></li>
<li class="chapter" data-level="12.11" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#extension-packages"><i class="fa fa-check"></i><b>12.11</b> Extension packages</a></li>
<li class="chapter" data-level="12.12" data-path="graphics-ggplot2.html"><a href="graphics-ggplot2.html#technical-notes"><i class="fa fa-check"></i><b>12.12</b> Technical notes</a></li>
</ul></li>
<li class="part"><span><b>V Organizing the analysis</b></span></li>
<li class="chapter" data-level="13" data-path="tables-nice.html"><a href="tables-nice.html"><i class="fa fa-check"></i><b>13</b> Generating nice tables</a></li>
<li class="chapter" data-level="14" data-path="dynamic-documents.html"><a href="dynamic-documents.html"><i class="fa fa-check"></i><b>14</b> Dynamic documents</a></li>
<li class="chapter" data-level="15" data-path="scripting-workflow.html"><a href="scripting-workflow.html"><i class="fa fa-check"></i><b>15</b> Scripting and workflow</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-processing" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Processing data<a href="data-processing.html#data-processing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="overview-1" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Overview<a href="data-processing.html#overview-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The previous section has already covered central aspects of data handling in base R: how to extract parts of a data frame, and how to change parts of a data frame, using either the bracket- or <code>$</code>-notation, or helper functions <code>subset</code> and <code>transform</code>. However, we have not yet discussed a good solution for working with <em>groups</em> of data, or how to combine data from multiple sources, which is what will be covered in this section. This will also involve a short excursion into how to write your own function in R, which is actually not hard and often very useful.</p>
<p>As example data, we will use the same data on blood pressure and salt consumption in 100 subjects already seen in Section <a href="intro-example.html#intro-example">4</a>:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="data-processing.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">head</span>(salt_ht, <span class="at">nrow =</span> <span class="dv">5</span>)</span>
<span id="cb125-2"><a href="data-processing.html#cb125-2" aria-hidden="true" tabindex="-1"></a>    ID    sex sbp dbp saltadd age</span>
<span id="cb125-3"><a href="data-processing.html#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">4305</span>   male <span class="dv">110</span>  <span class="dv">80</span>     yes  <span class="dv">58</span></span>
<span id="cb125-4"><a href="data-processing.html#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">6606</span> female  <span class="dv">85</span>  <span class="dv">55</span>      no  <span class="dv">32</span></span>
<span id="cb125-5"><a href="data-processing.html#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">5758</span> female <span class="dv">196</span> <span class="dv">128</span>    <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">53</span></span>
<span id="cb125-6"><a href="data-processing.html#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">2265</span>   male <span class="dv">167</span> <span class="dv">112</span>     yes  <span class="dv">68</span></span>
<span id="cb125-7"><a href="data-processing.html#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">7408</span> female <span class="dv">145</span> <span class="dv">110</span>     yes  <span class="dv">55</span></span>
<span id="cb125-8"><a href="data-processing.html#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">2160</span> female <span class="dv">179</span> <span class="dv">120</span>      no  <span class="dv">60</span></span></code></pre></div>
<p>As before, this section will only deal with methods from base R. For a demonstration of how to achieve the same tasks using the package that is part of the tidyverse, see Section <a href="data-tidyverse.html#data-tidyverse">7</a>.</p>
</div>
<div id="group-stats" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Groupwise statistics<a href="data-processing.html#group-stats" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For groupwise descriptive statistics, base R has the function <tt>aggregate</tt>, which offers a convenient formula interface. If we want to calculate e.g. the average systolic blood pressure in our example data for males and for females separately, we can do this:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="data-processing.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, mean)</span>
<span id="cb126-2"><a href="data-processing.html#cb126-2" aria-hidden="true" tabindex="-1"></a>     sex      sbp</span>
<span id="cb126-3"><a href="data-processing.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.8182</span></span>
<span id="cb126-4"><a href="data-processing.html#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.0444</span></span></code></pre></div>
<p>The variable to be aggregated (systolic blood pressure) is specified on the left hand side of the formula, and the grouping variable (sex) on the right hand side; the second argument is the data frame from where we draw these variables, i.e. <tt>salt_ht</tt>; and the third and final argument is the function we want to use to calculate a groupwise summary, here just the usual <tt>mean</tt>-function.</p>
<p>The return value from the <tt>aggregate</tt>-function is a data frame with as many rows as groups in the data (so here two), which shows the grouping levels (male and female) and the summary statistic (an average of ca. 158 for women and 150 for men). Note that this is <em>hugely</em> more compact and elegant than our standard approach so far, which was defining two separate subsets for males and females and calcularing the means on these.</p>
<p>If we want to calculate instead the standard deviation in each group, we just swap out the summary function in the call to aggregate, and replace <tt>mean</tt> with <tt>sd</tt>:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="data-processing.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, sd)</span>
<span id="cb127-2"><a href="data-processing.html#cb127-2" aria-hidden="true" tabindex="-1"></a>     sex      sbp</span>
<span id="cb127-3"><a href="data-processing.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">43.24482</span></span>
<span id="cb127-4"><a href="data-processing.html#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">33.81632</span></span></code></pre></div>
<p>We see that women also have greater variability in their blood pressures than men.</p>
<p>This basic approach can be extended in several ways. To start with, we can use a more complicated summary function like <tt>MeanCI</tt> from package <tt>DescTools</tt> to calculate separate means and confidence intervals:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="data-processing.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(DescTools)</span>
<span id="cb128-2"><a href="data-processing.html#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, MeanCI)</span>
<span id="cb128-3"><a href="data-processing.html#cb128-3" aria-hidden="true" tabindex="-1"></a>     sex sbp.mean sbp.lwr.ci sbp.upr.ci</span>
<span id="cb128-4"><a href="data-processing.html#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.8182</span>   <span class="fl">146.1275</span>   <span class="fl">169.5089</span></span>
<span id="cb128-5"><a href="data-processing.html#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.0444</span>   <span class="fl">139.8849</span>   <span class="fl">160.2040</span></span></code></pre></div>
<p><tt>MeanCI</tt> returns not just a single number like <tt>mean</tt> or <tt>sd</tt>, but a vector of length three, and consequently, the return value from <tt>aggregate</tt> has three separate columns for the summary statistics.</p>
<p>In addition, we can also specify multiple grouping variables at the same time, simply by listing them on the right hand side of the formula. separated by a plus sign. We then get summaries for all <em>combinations</em> of the specified grouping variables in the data set. Here, we get four groups for all combinations of male/female salt-adder/non-salt adder:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="data-processing.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex <span class="sc">+</span> saltadd, <span class="at">data =</span> salt_ht, mean)</span>
<span id="cb129-2"><a href="data-processing.html#cb129-2" aria-hidden="true" tabindex="-1"></a>     sex saltadd      sbp</span>
<span id="cb129-3"><a href="data-processing.html#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female      no <span class="fl">133.7692</span></span>
<span id="cb129-4"><a href="data-processing.html#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male      no <span class="fl">139.4167</span></span>
<span id="cb129-5"><a href="data-processing.html#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> female     yes <span class="fl">164.4643</span></span>
<span id="cb129-6"><a href="data-processing.html#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   male     yes <span class="fl">160.2667</span></span></code></pre></div>
<p>A point to remember is that <tt>aggregate</tt> will drop all rows of the data frame where any of the grouping variables are missing - you may remember from the initial example script that there are ca. 20% missing values for the <tt>saltadd</tt> variable, but this is not reflected in the results here. You can get around this by making the <tt>NA</tt>s a separate category of the <tt>saltadd</tt> variable in a pre-processing step, using the <tt>factor</tt>-function, but that is entirely your responsibility.</p>
<p>On top of this, we can also do on-the-fly transformations of the outcome variable on the left hand side as part of the formula. If we wanted for some reason to calculate the groupwise averages of the <em>logarithmised</em> blood pressures, we could do this:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="data-processing.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(<span class="fu">log</span>(sbp) <span class="sc">~</span> sex <span class="sc">+</span> saltadd, <span class="at">data =</span> salt_ht, mean)</span>
<span id="cb130-2"><a href="data-processing.html#cb130-2" aria-hidden="true" tabindex="-1"></a>     sex saltadd <span class="fu">log</span>(sbp)</span>
<span id="cb130-3"><a href="data-processing.html#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female      no <span class="fl">4.862900</span></span>
<span id="cb130-4"><a href="data-processing.html#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male      no <span class="fl">4.921043</span></span>
<span id="cb130-5"><a href="data-processing.html#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> female     yes <span class="fl">5.067426</span></span>
<span id="cb130-6"><a href="data-processing.html#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   male     yes <span class="fl">5.052278</span></span></code></pre></div>
<p>Finally, we can process multiple variables at the same time by specifying them within a call to the function <tt>cbind</tt>, which stands for <em>column-bind</em>, and combines the columns we are interested in into one single object suitable for the left hand side of a formula.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="data-processing.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(<span class="fu">cbind</span>(sbp, dbp) <span class="sc">~</span> sex <span class="sc">+</span> saltadd, <span class="at">data =</span> salt_ht, mean)</span>
<span id="cb131-2"><a href="data-processing.html#cb131-2" aria-hidden="true" tabindex="-1"></a>     sex saltadd      sbp       dbp</span>
<span id="cb131-3"><a href="data-processing.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female      no <span class="fl">133.7692</span>  <span class="fl">86.30769</span></span>
<span id="cb131-4"><a href="data-processing.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male      no <span class="fl">139.4167</span>  <span class="fl">90.33333</span></span>
<span id="cb131-5"><a href="data-processing.html#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> female     yes <span class="fl">164.4643</span> <span class="fl">106.17857</span></span>
<span id="cb131-6"><a href="data-processing.html#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   male     yes <span class="fl">160.2667</span> <span class="fl">102.40000</span></span></code></pre></div>
</div>
<div id="own-functions" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Using your own functions<a href="data-processing.html#own-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Defining a function</strong> What if we want to calculate the groupwise means and standard deviations at the same time, instead of running aggregate twice, as above? Then we need a function that takes as argument a numerical vector, and returns a vector of length two, with the mean as first element and the standard deviation as second element. Among the 19,000+ add-on packages on CRAN, we are virtually certain to find such function, but finding it will not be easy - indeed, it will be <em>much</em> simpler to write our own function for this.</p>
<p>Functions work a bit like recipes: ingredients go in, some processing takes place, and a delicious meal is returned. Let’s start with a trivial example, where we write a wrapper for the <tt>mean</tt> function. Instead of calling <tt>mean</tt> directly, we define a function with one argument <tt>x</tt>, which performs one action, namely calculating the mean value of <tt>x</tt>, and which returns exactly one value, namely that mean value, as result:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="data-processing.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, <span class="cf">function</span>(x) <span class="fu">mean</span>(x))</span>
<span id="cb132-2"><a href="data-processing.html#cb132-2" aria-hidden="true" tabindex="-1"></a>     sex      sbp</span>
<span id="cb132-3"><a href="data-processing.html#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.8182</span></span>
<span id="cb132-4"><a href="data-processing.html#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.0444</span></span></code></pre></div>
<p>Here, <tt>function</tt> tells R that we are about define our own function, the <tt>x</tt> in parentheses tells R that we expect exactly one argument, which we decide to call <tt>x</tt>, and the rest are the actual instructions what to do with the argument. Here, we just apss it on to the usual <tt>mean</tt>-function. By default, the function will return the value of the last command executed - as we only have one command, the call to <tt>mean</tt>, this is what we get back. And indeed, this works as intended.</p>
<p>Now that we have something simple that works, we can extend it to do something more useful: we have the same call to aggregate, starting with the same function definition, and the same argument <tt>x</tt>, but now we calculate both the mean of and the standard deviation of <tt>x</tt>; and we know already how to combine two unrelated numbers into a vector, namely by using the function <tt>c()</tt>:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="data-processing.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="fu">mean</span>(x), <span class="fu">sd</span>(x)))</span>
<span id="cb133-2"><a href="data-processing.html#cb133-2" aria-hidden="true" tabindex="-1"></a>     sex     sbp<span class="fl">.1</span>     sbp<span class="fl">.2</span></span>
<span id="cb133-3"><a href="data-processing.html#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.81818</span>  <span class="fl">43.24482</span></span>
<span id="cb133-4"><a href="data-processing.html#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.04444</span>  <span class="fl">33.81632</span></span></code></pre></div>
<p>And compared to the results above, this works exactly as intended. The only thing that is less than nice are the names of the summary columns.</p>
<p>We can take this a step further and try to fix the name issue, simply by adding name definitions in our call to <tt>c()</tt>: we call the first element <tt>Mean</tt> and the second <tt>StdDev</tt>. Even though we have not discussed this yet, this is a valid way of calling the <tt>c</tt>-function, and the result is still a vector of length two, but now with names<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a>.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="data-processing.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(x), <span class="at">StdDev =</span> <span class="fu">sd</span>(x)))</span>
<span id="cb134-2"><a href="data-processing.html#cb134-2" aria-hidden="true" tabindex="-1"></a>     sex  sbp.Mean sbp.StdDev</span>
<span id="cb134-3"><a href="data-processing.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.81818</span>   <span class="fl">43.24482</span></span>
<span id="cb134-4"><a href="data-processing.html#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.04444</span>   <span class="fl">33.81632</span></span></code></pre></div>
<p>Note that this stepwise refinement of our initial, very simple and not very useful function is a nice example for the rapid prototyping / fast iteration approach that works well with R: build something simple that works, and refine it step by step until you reach your goal.</p>
<p><strong>Creating a function object</strong> This new function that we have defined is actually not completely useless, and we may want to use it in other settings. We could of course re-type the same function definition as above whenever we need it, but that is hardly useful. Fortunately, we can save this function definition as an object (because R is not just functional, but also object-oriented):</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="data-processing.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> MeanSd <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(x), <span class="at">StdDev =</span> <span class="fu">sd</span>(x))</span></code></pre></div>
<p>We now have define our first own function object. If we just type the name, R will display the definition (value) of the function:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="data-processing.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> MeanSd</span>
<span id="cb136-2"><a href="data-processing.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(x), <span class="at">StdDev =</span> <span class="fu">sd</span>(x))</span></code></pre></div>
<p>This works exactly as before:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="data-processing.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, MeanSd)</span>
<span id="cb137-2"><a href="data-processing.html#cb137-2" aria-hidden="true" tabindex="-1"></a>     sex  sbp.Mean sbp.StdDev</span>
<span id="cb137-3"><a href="data-processing.html#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.81818</span>   <span class="fl">43.24482</span></span>
<span id="cb137-4"><a href="data-processing.html#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.04444</span>   <span class="fl">33.81632</span></span></code></pre></div>
<p>However, this function now works everywhere<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a>, even outside of <tt>aggregate</tt>:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="data-processing.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">MeanSd</span>(salt_ht<span class="sc">$</span>sbp)</span>
<span id="cb138-2"><a href="data-processing.html#cb138-2" aria-hidden="true" tabindex="-1"></a>     Mean    StdDev </span>
<span id="cb138-3"><a href="data-processing.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="fl">154.32000</span>  <span class="fl">39.28628</span> </span></code></pre></div>
</div>
<div id="split-apply-combine" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Split - Apply - Combine<a href="data-processing.html#split-apply-combine" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Background</strong> <tt>aggregate</tt> works well for simple summary statistics like a mean or a median, and reasonably well for slightly more complex summary functions like <tt>MeanCI</tt> or our own <tt>MeanSd</tt>. However, for more complicated groupwise operations, this becomes awkward. Therefore, we will consider a more general mechanism that allows groupwise operations of <em>any</em> complexity, and which is well supported in a number of data processing languages. This is a three step process:</p>
<ol style="list-style-type: decimal">
<li><em>Split</em> the data into the groups you are interested in.</li>
<li><em>Apply</em> whatever processing or modelling function you want to run to the separate data chunks you have created in the first step.</li>
<li><em>Combine</em> the results from applying the function to the different data chunks into an informative ensemble.</li>
</ol>
<p>In base R, this can be implemented via a pair of functions, <tt>split</tt> and <tt>lapply</tt>, where</p>
<ul>
<li><p><tt>split</tt> takes as arguments a data frame and some grouping information, and returns a <em>named list</em><a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a> of data frames: each list element is a smaller data frame, with the same columns as the full data set, but only the rows corresponding to one group at a time, so that the list has as many elements (as many sub-data frames) as there are grouping levels.</p></li>
<li><p><tt>lapply</tt> takes this list as first argument, together with the function we want to run on each sub-data frame as the second argument. <tt>lapply</tt> will run this for us, and collect the return values as a list of the same length as the input list.</p></li>
</ul>
<p>You will notice that there is no extra function for the combination step here: as shown below, this can either be skipped, or implemented by a second call to <tt>lapply</tt>. With this approach, we can run any kind of per-group calculation, even if the output is complicated, like for regression models.</p>
<p>There is also a variant of <tt>lapply</tt> called <tt>sapply</tt>, for <em>simplified apply</em>, which under some circumstances will be able to return not a list, but some nice rectangular object, as demonstrated in the example below.</p>
<p><strong>Example I: descriptives</strong> We start by splitting the salt data by levels of sex. The resulting object <tt>split_salt</tt> is a list with two elements, with names <tt>female</tt> and <tt>male</tt>, and each element is a data frame with same six columns as the original data:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="data-processing.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> split_salt <span class="ot">&lt;-</span> <span class="fu">split</span>(salt_ht, salt_ht<span class="sc">$</span>sex)</span>
<span id="cb139-2"><a href="data-processing.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">str</span>(split_salt)</span>
<span id="cb139-3"><a href="data-processing.html#cb139-3" aria-hidden="true" tabindex="-1"></a>List of <span class="dv">2</span></span>
<span id="cb139-4"><a href="data-processing.html#cb139-4" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> female<span class="sc">:</span><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span> <span class="dv">55</span> obs. of  <span class="dv">6</span> variables<span class="sc">:</span></span>
<span id="cb139-5"><a href="data-processing.html#cb139-5" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> ID     <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">55</span>] <span class="dv">6606</span> <span class="dv">5758</span> <span class="dv">7408</span> <span class="dv">2160</span> <span class="dv">8202</span> <span class="dv">9571</span> <span class="dv">4767</span> <span class="dv">1024</span> <span class="dv">2627</span> <span class="dv">7707</span> ...</span>
<span id="cb139-6"><a href="data-processing.html#cb139-6" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> sex    <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span><span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb139-7"><a href="data-processing.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> sbp    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">55</span>] <span class="dv">85</span> <span class="dv">196</span> <span class="dv">145</span> <span class="dv">179</span> <span class="dv">110</span> <span class="dv">133</span> <span class="dv">149</span> <span class="dv">178</span> <span class="dv">126</span> <span class="dv">182</span> ...</span>
<span id="cb139-8"><a href="data-processing.html#cb139-8" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> dbp    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">55</span>] <span class="dv">55</span> <span class="dv">128</span> <span class="dv">110</span> <span class="dv">120</span> <span class="dv">70</span> <span class="dv">75</span> <span class="dv">72</span> <span class="dv">128</span> <span class="dv">78</span> <span class="dv">96</span> ...</span>
<span id="cb139-9"><a href="data-processing.html#cb139-9" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> saltadd<span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;no&quot;</span>,<span class="st">&quot;yes&quot;</span><span class="sc">:</span> <span class="dv">1</span> <span class="cn">NA</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">2</span> ...</span>
<span id="cb139-10"><a href="data-processing.html#cb139-10" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> age    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">55</span>] <span class="dv">32</span> <span class="dv">53</span> <span class="dv">55</span> <span class="dv">60</span> <span class="dv">32</span> <span class="dv">46</span> <span class="dv">63</span> <span class="dv">63</span> <span class="dv">46</span> <span class="dv">60</span> ...</span>
<span id="cb139-11"><a href="data-processing.html#cb139-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> male  <span class="sc">:</span><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span> <span class="dv">45</span> obs. of  <span class="dv">6</span> variables<span class="sc">:</span></span>
<span id="cb139-12"><a href="data-processing.html#cb139-12" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> ID     <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>] <span class="dv">4305</span> <span class="dv">2265</span> <span class="dv">8846</span> <span class="dv">9605</span> <span class="dv">4137</span> <span class="dv">1598</span> <span class="dv">9962</span> <span class="dv">1006</span> <span class="dv">7120</span> <span class="dv">6888</span> ...</span>
<span id="cb139-13"><a href="data-processing.html#cb139-13" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> sex    <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> ...</span>
<span id="cb139-14"><a href="data-processing.html#cb139-14" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> sbp    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>] <span class="dv">110</span> <span class="dv">167</span> <span class="dv">111</span> <span class="dv">198</span> <span class="dv">171</span> <span class="dv">118</span> <span class="dv">140</span> <span class="dv">192</span> <span class="dv">118</span> <span class="dv">121</span> ...</span>
<span id="cb139-15"><a href="data-processing.html#cb139-15" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> dbp    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>] <span class="dv">80</span> <span class="dv">112</span> <span class="dv">78</span> <span class="dv">119</span> <span class="dv">102</span> <span class="dv">72</span> <span class="dv">90</span> <span class="dv">118</span> <span class="dv">72</span> <span class="dv">86</span> ...</span>
<span id="cb139-16"><a href="data-processing.html#cb139-16" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> saltadd<span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;no&quot;</span>,<span class="st">&quot;yes&quot;</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb139-17"><a href="data-processing.html#cb139-17" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> age    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>] <span class="dv">58</span> <span class="dv">68</span> <span class="dv">59</span> <span class="dv">63</span> <span class="dv">58</span> <span class="dv">52</span> <span class="dv">67</span> <span class="dv">42</span> <span class="dv">40</span> <span class="dv">36</span> ...</span></code></pre></div>
<p>We start with a simple <code>summary</code>:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="data-processing.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_salt, summary)</span>
<span id="cb140-2"><a href="data-processing.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb140-3"><a href="data-processing.html#cb140-3" aria-hidden="true" tabindex="-1"></a>       ID           sex          sbp             dbp        saltadd        age       </span>
<span id="cb140-4"><a href="data-processing.html#cb140-4" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="dv">1024</span>   female<span class="sc">:</span><span class="dv">55</span>   Min.   <span class="sc">:</span> <span class="fl">80.0</span>   Min.   <span class="sc">:</span> <span class="fl">55.0</span>   no  <span class="sc">:</span><span class="dv">13</span>   Min.   <span class="sc">:</span><span class="fl">26.00</span>  </span>
<span id="cb140-5"><a href="data-processing.html#cb140-5" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="dv">2632</span>   male  <span class="sc">:</span> <span class="dv">0</span>   1st Qu.<span class="sc">:</span><span class="fl">121.5</span>   1st Qu.<span class="sc">:</span> <span class="fl">80.0</span>   yes <span class="sc">:</span><span class="dv">28</span>   1st Qu.<span class="sc">:</span><span class="fl">37.50</span>  </span>
<span id="cb140-6"><a href="data-processing.html#cb140-6" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="dv">5758</span>               Median <span class="sc">:</span><span class="fl">152.0</span>   Median <span class="sc">:</span><span class="fl">102.0</span>   NA<span class="st">&#39;s:14   Median :48.00  </span></span>
<span id="cb140-7"><a href="data-processing.html#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="st"> Mean   :5256               Mean   :157.8   Mean   :100.8             Mean   :47.69  </span></span>
<span id="cb140-8"><a href="data-processing.html#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="st"> 3rd Qu.:7536               3rd Qu.:194.5   3rd Qu.:119.0             3rd Qu.:58.00  </span></span>
<span id="cb140-9"><a href="data-processing.html#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="st"> Max.   :9899               Max.   :238.0   Max.   :158.0             Max.   :71.00  </span></span>
<span id="cb140-10"><a href="data-processing.html#cb140-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-11"><a href="data-processing.html#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="st">$male</span></span>
<span id="cb140-12"><a href="data-processing.html#cb140-12" aria-hidden="true" tabindex="-1"></a><span class="st">       ID           sex          sbp           dbp         saltadd        age       </span></span>
<span id="cb140-13"><a href="data-processing.html#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="st"> Min.   :1006   female: 0   Min.   :110   Min.   : 68.00   no  :24   Min.   :29.00  </span></span>
<span id="cb140-14"><a href="data-processing.html#cb140-14" aria-hidden="true" tabindex="-1"></a><span class="st"> 1st Qu.:3210   male  :45   1st Qu.:121   1st Qu.: 82.00   yes :15   1st Qu.:41.00  </span></span>
<span id="cb140-15"><a href="data-processing.html#cb140-15" aria-hidden="true" tabindex="-1"></a><span class="st"> Median :4592               Median :137   Median : 90.00   NA&#39;</span>s<span class="sc">:</span> <span class="dv">6</span>   Median <span class="sc">:</span><span class="fl">53.00</span>  </span>
<span id="cb140-16"><a href="data-processing.html#cb140-16" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="dv">5192</span>               Mean   <span class="sc">:</span><span class="dv">150</span>   Mean   <span class="sc">:</span> <span class="fl">95.71</span>             Mean   <span class="sc">:</span><span class="fl">49.96</span>  </span>
<span id="cb140-17"><a href="data-processing.html#cb140-17" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="dv">7120</span>               3rd Qu.<span class="sc">:</span><span class="dv">171</span>   3rd Qu.<span class="sc">:</span><span class="fl">110.00</span>             3rd Qu.<span class="sc">:</span><span class="fl">58.00</span>  </span>
<span id="cb140-18"><a href="data-processing.html#cb140-18" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="dv">9962</span>               Max.   <span class="sc">:</span><span class="dv">225</span>   Max.   <span class="sc">:</span><span class="fl">150.00</span>             Max.   <span class="sc">:</span><span class="fl">68.00</span>  </span></code></pre></div>
<p>As expected, this returns a list with two elements, each of them a <tt>summary</tt> output.</p>
<p>At first glance, this may look very similar to the manual splitting we have been doing previously using the <tt>subset</tt>-function. However, this is <em>not</em> the case: there, we had to keep track of each level of the grouping variable es, and create each sub-data frame manually as a separate object. Here, this works the same whether the grouping variable has two or 18 levels, and the result is always one list object instead of two or 18 data frame objects, which can be processed with a single call to <tt>lapply</tt>.</p>
<p>This also works for a more complicated descriptive function like </tt>descr</tt> from package <tt>summarytools</tt>. We can even add extra arguments to <tt>lapply</tt>, like <tt>stats</tt> here, which will be passed on to <tt>descr</tt>:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="data-processing.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(summarytools)</span>
<span id="cb141-2"><a href="data-processing.html#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_salt, descr, <span class="at">stats =</span> <span class="st">&quot;common&quot;</span>)</span></code></pre></div>
<p>This creates the a list of two summary tables, using the somewhat shorter outpit format corresponding to <code>stats="common"</code> (see <code>?descr</code> for details).</p>
<p>We can even use this mechanism to do implement something similar to <tt>aggregate</tt> by defining our own processing function: here, the argument <tt>x</tt> for the function is a data frame, the part of the original data corresponding to single grouping level; we can therefore extract the variable <tt>sbp</tt> with the usual <tt>$</tt>-notation and pass this vector as argument to <tt>MeanCI</tt>. This returns a list with two confidence intervals, one for females, one for males:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="data-processing.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">MeanCI</span>(x<span class="sc">$</span>sbp))</span>
<span id="cb142-2"><a href="data-processing.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb142-3"><a href="data-processing.html#cb142-3" aria-hidden="true" tabindex="-1"></a>    mean   lwr.ci   upr.ci </span>
<span id="cb142-4"><a href="data-processing.html#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="fl">157.8182</span> <span class="fl">146.1275</span> <span class="fl">169.5089</span> </span>
<span id="cb142-5"><a href="data-processing.html#cb142-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-6"><a href="data-processing.html#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb142-7"><a href="data-processing.html#cb142-7" aria-hidden="true" tabindex="-1"></a>    mean   lwr.ci   upr.ci </span>
<span id="cb142-8"><a href="data-processing.html#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="fl">150.0444</span> <span class="fl">139.8849</span> <span class="fl">160.2040</span> </span></code></pre></div>
<p>This is actually a sitation where we can use the <tt>sapply</tt> function to improve the output: <tt>sapply</tt> understands that the output from each of the separate function calls are all vectors of the same length and combines them for us.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="data-processing.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">MeanCI</span>(x<span class="sc">$</span>sbp))</span>
<span id="cb143-2"><a href="data-processing.html#cb143-2" aria-hidden="true" tabindex="-1"></a>         female     male</span>
<span id="cb143-3"><a href="data-processing.html#cb143-3" aria-hidden="true" tabindex="-1"></a>mean   <span class="fl">157.8182</span> <span class="fl">150.0444</span></span>
<span id="cb143-4"><a href="data-processing.html#cb143-4" aria-hidden="true" tabindex="-1"></a>lwr.ci <span class="fl">146.1275</span> <span class="fl">139.8849</span></span>
<span id="cb143-5"><a href="data-processing.html#cb143-5" aria-hidden="true" tabindex="-1"></a>upr.ci <span class="fl">169.5089</span> <span class="fl">160.2040</span></span></code></pre></div>
<p>This is almost useful; if we combine this with the function <tt>t()</tt> (for <em>transpose</em>), which flips rows and columns of a matrix, we get something very similar to the original <tt>aggregate</tt> output:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="data-processing.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">t</span>(<span class="fu">sapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">MeanCI</span>(x<span class="sc">$</span>sbp)))</span>
<span id="cb144-2"><a href="data-processing.html#cb144-2" aria-hidden="true" tabindex="-1"></a>           mean   lwr.ci   upr.ci</span>
<span id="cb144-3"><a href="data-processing.html#cb144-3" aria-hidden="true" tabindex="-1"></a>female <span class="fl">157.8182</span> <span class="fl">146.1275</span> <span class="fl">169.5089</span></span>
<span id="cb144-4"><a href="data-processing.html#cb144-4" aria-hidden="true" tabindex="-1"></a>male   <span class="fl">150.0444</span> <span class="fl">139.8849</span> <span class="fl">160.2040</span></span></code></pre></div>
<p>In this sense, <tt>split</tt>/<tt>sapply</tt> is the more general approach than <tt>aggregate</tt>, but for simpler use cases like this example here, <tt>aggregate</tt> is easier to use.</p>
<p><strong>Example II: tests &amp; models</strong> The <tt>split</tt>/<tt>sapply</tt> approach works especially well with functions that have a formula interface, as these functions generally have a <tt>data</tt>-argument to specify the data frame from which to take the variables in the formula. Consequently, it is very easy to run e.g. groupwise t-tests:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="data-processing.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">t.test</span>(sbp <span class="sc">~</span> saltadd, <span class="at">data =</span> x))</span>
<span id="cb145-2"><a href="data-processing.html#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb145-3"><a href="data-processing.html#cb145-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-4"><a href="data-processing.html#cb145-4" aria-hidden="true" tabindex="-1"></a>    Welch Two Sample t<span class="sc">-</span>test</span>
<span id="cb145-5"><a href="data-processing.html#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="data-processing.html#cb145-6" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span>  sbp by saltadd</span>
<span id="cb145-7"><a href="data-processing.html#cb145-7" aria-hidden="true" tabindex="-1"></a>t <span class="ot">=</span> <span class="sc">-</span><span class="fl">2.4579</span>, df <span class="ot">=</span> <span class="fl">27.399</span>, p<span class="sc">-</span>value <span class="ot">=</span> <span class="fl">0.02058</span></span>
<span id="cb145-8"><a href="data-processing.html#cb145-8" aria-hidden="true" tabindex="-1"></a>alternative hypothesis<span class="sc">:</span> true difference <span class="cf">in</span> means between group no and group yes is not equal to <span class="dv">0</span></span>
<span id="cb145-9"><a href="data-processing.html#cb145-9" aria-hidden="true" tabindex="-1"></a><span class="dv">95</span> percent confidence interval<span class="sc">:</span></span>
<span id="cb145-10"><a href="data-processing.html#cb145-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">-</span><span class="fl">56.301333</span>  <span class="sc">-</span><span class="fl">5.088777</span></span>
<span id="cb145-11"><a href="data-processing.html#cb145-11" aria-hidden="true" tabindex="-1"></a>sample estimates<span class="sc">:</span></span>
<span id="cb145-12"><a href="data-processing.html#cb145-12" aria-hidden="true" tabindex="-1"></a> mean <span class="cf">in</span> group no mean <span class="cf">in</span> group yes </span>
<span id="cb145-13"><a href="data-processing.html#cb145-13" aria-hidden="true" tabindex="-1"></a>         <span class="fl">133.7692</span>          <span class="fl">164.4643</span> </span>
<span id="cb145-14"><a href="data-processing.html#cb145-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-15"><a href="data-processing.html#cb145-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-16"><a href="data-processing.html#cb145-16" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb145-17"><a href="data-processing.html#cb145-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-18"><a href="data-processing.html#cb145-18" aria-hidden="true" tabindex="-1"></a>    Welch Two Sample t<span class="sc">-</span>test</span>
<span id="cb145-19"><a href="data-processing.html#cb145-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-20"><a href="data-processing.html#cb145-20" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span>  sbp by saltadd</span>
<span id="cb145-21"><a href="data-processing.html#cb145-21" aria-hidden="true" tabindex="-1"></a>t <span class="ot">=</span> <span class="sc">-</span><span class="fl">1.9155</span>, df <span class="ot">=</span> <span class="fl">23.455</span>, p<span class="sc">-</span>value <span class="ot">=</span> <span class="fl">0.0677</span></span>
<span id="cb145-22"><a href="data-processing.html#cb145-22" aria-hidden="true" tabindex="-1"></a>alternative hypothesis<span class="sc">:</span> true difference <span class="cf">in</span> means between group no and group yes is not equal to <span class="dv">0</span></span>
<span id="cb145-23"><a href="data-processing.html#cb145-23" aria-hidden="true" tabindex="-1"></a><span class="dv">95</span> percent confidence interval<span class="sc">:</span></span>
<span id="cb145-24"><a href="data-processing.html#cb145-24" aria-hidden="true" tabindex="-1"></a> <span class="sc">-</span><span class="fl">43.343346</span>   <span class="fl">1.643346</span></span>
<span id="cb145-25"><a href="data-processing.html#cb145-25" aria-hidden="true" tabindex="-1"></a>sample estimates<span class="sc">:</span></span>
<span id="cb145-26"><a href="data-processing.html#cb145-26" aria-hidden="true" tabindex="-1"></a> mean <span class="cf">in</span> group no mean <span class="cf">in</span> group yes </span>
<span id="cb145-27"><a href="data-processing.html#cb145-27" aria-hidden="true" tabindex="-1"></a>         <span class="fl">139.4167</span>          <span class="fl">160.2667</span> </span></code></pre></div>
<p>We get a list with two elements, <tt>female</tt> and <tt>male</tt>, and each element is a t-test result (here with a conventionally statistically significant difference for females, but not for males). Note that test results like these are relatively complicated R objects, so sapply is not going to do us much good in this situation.</p>
<p>This works exactly the same for regression: if we want to model systolic blood pressure as function of diastolic blood pressure for females and males separately, we use the same type of wrapping function where we pass in the data argument to function <tt>lm</tt>:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="data-processing.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> split_lm <span class="ot">&lt;-</span> <span class="fu">lapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">lm</span>(sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x))</span>
<span id="cb146-2"><a href="data-processing.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> split_lm</span>
<span id="cb146-3"><a href="data-processing.html#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb146-4"><a href="data-processing.html#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="data-processing.html#cb146-5" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb146-6"><a href="data-processing.html#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x)</span>
<span id="cb146-7"><a href="data-processing.html#cb146-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-8"><a href="data-processing.html#cb146-8" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb146-9"><a href="data-processing.html#cb146-9" aria-hidden="true" tabindex="-1"></a>(Intercept)          dbp  </span>
<span id="cb146-10"><a href="data-processing.html#cb146-10" aria-hidden="true" tabindex="-1"></a>      <span class="fl">11.63</span>         <span class="fl">1.45</span>  </span>
<span id="cb146-11"><a href="data-processing.html#cb146-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-12"><a href="data-processing.html#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="data-processing.html#cb146-13" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb146-14"><a href="data-processing.html#cb146-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-15"><a href="data-processing.html#cb146-15" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb146-16"><a href="data-processing.html#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x)</span>
<span id="cb146-17"><a href="data-processing.html#cb146-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-18"><a href="data-processing.html#cb146-18" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb146-19"><a href="data-processing.html#cb146-19" aria-hidden="true" tabindex="-1"></a>(Intercept)          dbp  </span>
<span id="cb146-20"><a href="data-processing.html#cb146-20" aria-hidden="true" tabindex="-1"></a>     <span class="sc">-</span><span class="fl">1.655</span>        <span class="fl">1.585</span>  </span></code></pre></div>
<p>he result is again a list of length two, and each is this the kind of very short summary we get for a linear regression object at the console, showing only the original function call and the estimated coefficients - note that the call looks the same for both elements, but the estimates are different, because <tt>x</tt> means different things for the two models.</p>
<p>Here it makes sense to run an extra post-processing step after the model fit(s). If we want to see a mreo informative summary of the model, including standard errors and p-values for the regression parameters and measures of model fit like <span class="math inline">\(R^2\)</span>, we can run <tt>summary</tt> on each model:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="data-processing.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_lm, summary)</span>
<span id="cb147-2"><a href="data-processing.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb147-3"><a href="data-processing.html#cb147-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-4"><a href="data-processing.html#cb147-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb147-5"><a href="data-processing.html#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x)</span>
<span id="cb147-6"><a href="data-processing.html#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="data-processing.html#cb147-7" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb147-8"><a href="data-processing.html#cb147-8" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb147-9"><a href="data-processing.html#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">42.271</span> <span class="sc">-</span><span class="fl">12.851</span>  <span class="sc">-</span><span class="fl">6.396</span>  <span class="fl">12.591</span>  <span class="fl">63.441</span> </span>
<span id="cb147-10"><a href="data-processing.html#cb147-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-11"><a href="data-processing.html#cb147-11" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb147-12"><a href="data-processing.html#cb147-12" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb147-13"><a href="data-processing.html#cb147-13" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">11.6308</span>    <span class="fl">12.5337</span>   <span class="fl">0.928</span>    <span class="fl">0.358</span>    </span>
<span id="cb147-14"><a href="data-processing.html#cb147-14" aria-hidden="true" tabindex="-1"></a>dbp           <span class="fl">1.4503</span>     <span class="fl">0.1206</span>  <span class="fl">12.025</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb147-15"><a href="data-processing.html#cb147-15" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb147-16"><a href="data-processing.html#cb147-16" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb147-17"><a href="data-processing.html#cb147-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-18"><a href="data-processing.html#cb147-18" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">22.61</span> on <span class="dv">53</span> degrees of freedom</span>
<span id="cb147-19"><a href="data-processing.html#cb147-19" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.7318</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.7267</span> </span>
<span id="cb147-20"><a href="data-processing.html#cb147-20" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">144.6</span> on <span class="dv">1</span> and <span class="dv">53</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span>
<span id="cb147-21"><a href="data-processing.html#cb147-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-22"><a href="data-processing.html#cb147-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-23"><a href="data-processing.html#cb147-23" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb147-24"><a href="data-processing.html#cb147-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-25"><a href="data-processing.html#cb147-25" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb147-26"><a href="data-processing.html#cb147-26" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x)</span>
<span id="cb147-27"><a href="data-processing.html#cb147-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-28"><a href="data-processing.html#cb147-28" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb147-29"><a href="data-processing.html#cb147-29" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb147-30"><a href="data-processing.html#cb147-30" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">34.091</span> <span class="sc">-</span><span class="fl">10.973</span>  <span class="sc">-</span><span class="fl">1.218</span>  <span class="fl">10.609</span>  <span class="fl">35.968</span> </span>
<span id="cb147-31"><a href="data-processing.html#cb147-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-32"><a href="data-processing.html#cb147-32" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb147-33"><a href="data-processing.html#cb147-33" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb147-34"><a href="data-processing.html#cb147-34" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="sc">-</span><span class="fl">1.6551</span>    <span class="fl">12.8944</span>  <span class="sc">-</span><span class="fl">0.128</span>    <span class="fl">0.898</span>    </span>
<span id="cb147-35"><a href="data-processing.html#cb147-35" aria-hidden="true" tabindex="-1"></a>dbp           <span class="fl">1.5850</span>     <span class="fl">0.1323</span>  <span class="fl">11.983</span> <span class="fl">2.71e-15</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb147-36"><a href="data-processing.html#cb147-36" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb147-37"><a href="data-processing.html#cb147-37" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb147-38"><a href="data-processing.html#cb147-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-39"><a href="data-processing.html#cb147-39" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">16.42</span> on <span class="dv">43</span> degrees of freedom</span>
<span id="cb147-40"><a href="data-processing.html#cb147-40" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.7695</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.7642</span> </span>
<span id="cb147-41"><a href="data-processing.html#cb147-41" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">143.6</span> on <span class="dv">1</span> and <span class="dv">43</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">2.707e-15</span></span></code></pre></div>
<p>We see rather similar slopes for both models, both highly statistically significant, but rather different intercepts, which however are not statistically significantly different from zero.</p>
<p>Alternatively, if we are just interested in the slopes of the regression models, we can just extract these and use <tt>sapply</tt> for a more compact output:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="data-processing.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sapply</span>(split_lm, <span class="cf">function</span>(x) <span class="fu">coef</span>(x)[<span class="dv">2</span>])</span>
<span id="cb148-2"><a href="data-processing.html#cb148-2" aria-hidden="true" tabindex="-1"></a>female.dbp   male.dbp </span>
<span id="cb148-3"><a href="data-processing.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.450272</span>   <span class="fl">1.584973</span> </span></code></pre></div>
</div>
<div id="merge-data-base" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Merging data sets<a href="data-processing.html#merge-data-base" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Background</strong> So far, we have had our data conveniently available as one large data frame, with all variables and subjects of interest collected in one object. However, this is rarely how data starts out: a Swedish register study will have commonly multiple different sources of data, combining information from e.g. the cancer register, patient register, and drug prescription register. Consequently, one of the first steps of data preparation is to combine all required information from the available sources.</p>
<p>Merging data will generally require a unique subject identifier that is shared across the different data sources: for Swedish registers, this will usually be the personal identification number (PID, Swedish <em>personnummer</em>), or some pseudonymized version thereof (usually a sequential identification number, or running number, Swedish <em>löpnummer</em>).<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a> From there, the process is straightforward: you start with your canonical list of participants (aka your study cohort), and you keep linking in information from other data sources one at a time until you have collected all required information in one table.[^yesbut]</p>
<p>So this reduces the problem to merging two tables at a time. In base R, this can be done via the <tt>merge</tt>-function: this function is not especially fast, and has a somewhat special interface, but it works out of the box.</p>
<p><strong>Example: adding columns</strong> The data for the salt-intake example was actually collected at a number of different health centers. This information is not part of the original data, but we happen to have an extra text file that contains the health centers, and we want to add this information to the existing data frame <tt>salt_ht</tt>.</p>
<p>We first read in the file as usually:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="data-processing.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> centers <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;Data/center_saltadd.txt&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-2"><a href="data-processing.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(centers)</span>
<span id="cb149-3"><a href="data-processing.html#cb149-3" aria-hidden="true" tabindex="-1"></a>       ID       Center</span>
<span id="cb149-4"><a href="data-processing.html#cb149-4" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="dv">1006</span>   A<span class="sc">:</span><span class="dv">56</span>  </span>
<span id="cb149-5"><a href="data-processing.html#cb149-5" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="dv">2787</span>   B<span class="sc">:</span><span class="dv">57</span>  </span>
<span id="cb149-6"><a href="data-processing.html#cb149-6" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="dv">5527</span>   C<span class="sc">:</span><span class="dv">37</span>  </span>
<span id="cb149-7"><a href="data-processing.html#cb149-7" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="dv">5367</span>         </span>
<span id="cb149-8"><a href="data-processing.html#cb149-8" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="dv">7754</span>         </span>
<span id="cb149-9"><a href="data-processing.html#cb149-9" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="dv">9962</span>         </span></code></pre></div>
<p>The new data frame <tt>centers</tt> has two variables, one which seems to be a unique identifier (<tt>ID</tt>) and one with the center information (<tt>Center</tt>, A-D). However, it is also clear that the new data sets has information on more subjects (more than 100) than we have in the original data. A direct comparison also shows that these data frames are definitely not in the same order:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="data-processing.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> centers[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, ]</span>
<span id="cb150-2"><a href="data-processing.html#cb150-2" aria-hidden="true" tabindex="-1"></a>    ID Center</span>
<span id="cb150-3"><a href="data-processing.html#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1006</span>      A</span>
<span id="cb150-4"><a href="data-processing.html#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1086</span>      A</span>
<span id="cb150-5"><a href="data-processing.html#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1219</span>      A</span>
<span id="cb150-6"><a href="data-processing.html#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1265</span>      A</span>
<span id="cb150-7"><a href="data-processing.html#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> salt_ht[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, ]</span>
<span id="cb150-8"><a href="data-processing.html#cb150-8" aria-hidden="true" tabindex="-1"></a>    ID    sex sbp dbp saltadd age</span>
<span id="cb150-9"><a href="data-processing.html#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">4305</span>   male <span class="dv">110</span>  <span class="dv">80</span>     yes  <span class="dv">58</span></span>
<span id="cb150-10"><a href="data-processing.html#cb150-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">6606</span> female  <span class="dv">85</span>  <span class="dv">55</span>      no  <span class="dv">32</span></span>
<span id="cb150-11"><a href="data-processing.html#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">5758</span> female <span class="dv">196</span> <span class="dv">128</span>    <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">53</span></span>
<span id="cb150-12"><a href="data-processing.html#cb150-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">2265</span>   male <span class="dv">167</span> <span class="dv">112</span>     yes  <span class="dv">68</span></span></code></pre></div>
<p>In a first step, we want to see how many individuals in the original salt data also have information on the health center. We can do this via the function <code>setdiff</code>, which takes as arguments two vectors, and returns the vector of all elements which are part of the first, but not the second vector:<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="data-processing.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">setdiff</span>(salt_ht<span class="sc">$</span>ID, centers<span class="sc">$</span>ID)</span>
<span id="cb151-2"><a href="data-processing.html#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">integer</span>(<span class="dv">0</span>)</span>
<span id="cb151-3"><a href="data-processing.html#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">setdiff</span>(centers<span class="sc">$</span>ID, salt_ht<span class="sc">$</span>ID)</span>
<span id="cb151-4"><a href="data-processing.html#cb151-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">1265</span> <span class="dv">1458</span> <span class="dv">1514</span> <span class="dv">1678</span> <span class="dv">2769</span> <span class="dv">3388</span> <span class="dv">3678</span> <span class="dv">3966</span> <span class="dv">5723</span> <span class="dv">6358</span> <span class="dv">6911</span> <span class="dv">7076</span> <span class="dv">7228</span> <span class="dv">7689</span> <span class="dv">8129</span> <span class="dv">8396</span> <span class="dv">8990</span> <span class="dv">9113</span> <span class="dv">9469</span></span>
<span id="cb151-5"><a href="data-processing.html#cb151-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">20</span>] <span class="dv">9470</span> <span class="dv">9490</span> <span class="dv">9943</span> <span class="dv">9949</span> <span class="dv">1014</span> <span class="dv">1162</span> <span class="dv">1533</span> <span class="dv">1670</span> <span class="dv">1700</span> <span class="dv">1938</span> <span class="dv">2621</span> <span class="dv">3117</span> <span class="dv">3597</span> <span class="dv">3762</span> <span class="dv">4346</span> <span class="dv">5520</span> <span class="dv">5764</span> <span class="dv">5791</span> <span class="dv">7915</span></span>
<span id="cb151-6"><a href="data-processing.html#cb151-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">39</span>] <span class="dv">8069</span> <span class="dv">8179</span> <span class="dv">8993</span> <span class="dv">9226</span> <span class="dv">9580</span> <span class="dv">9754</span> <span class="dv">2304</span> <span class="dv">2523</span> <span class="dv">5070</span> <span class="dv">6210</span> <span class="dv">8023</span> <span class="dv">9358</span></span></code></pre></div>
<p>We see that removing the identifiers in the center-data from the identifiers in the original salt study returns a vector of length zero: this means there is no subject left from the original data frame form whom we do not have information on the center in the second data set - good! Flipping this however, by removing the original salt data IDs from the center IDs, we get a non-zero vector of subject IDs for which we have center information, but none of the blood pressure- or demographic variables. This means that we can augment our original data set, by adding the <tt>Center</tt> variable to <tt>salt_ht</tt>. In database language, this is known as a <em>left join</em>, and we can use merge to do this:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="data-processing.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> salt_ht_centers <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> salt_ht, <span class="at">y =</span> centers, <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">all.y =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We specify the original <tt>salt_ht</tt> as the first data set (argument <tt>x</tt>), and the center data set as second argument (<tt>y</tt>); we tell <tt>merge</tt> which column holds the identifier (this case column <tt>ID</tt> in both data frames); and then we decide what is kept and what is dropped: by setting <code>all.x = TRUE</code>, we state that we want all rows in <tt>x</tt>, that is <tt>salt_ht</tt>, to appear in the result. At the same time, we set <code>all.y = FALSE</code>, thereby stating that all rows of <tt>y</tt> (the center data) which have no match in <tt>x</tt>, should be dropped from the result.</p>
<p>For this combination of <tt>all.x</tt> and <tt>all.y</tt>, the result should be a data frame with the same number of rows as <tt>salt_ht</tt>, but extra columns from <tt>centers</tt>:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="data-processing.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(salt_ht_centers)</span>
<span id="cb153-2"><a href="data-processing.html#cb153-2" aria-hidden="true" tabindex="-1"></a>       ID           sex          sbp             dbp         saltadd        age        Center</span>
<span id="cb153-3"><a href="data-processing.html#cb153-3" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="dv">1006</span>   female<span class="sc">:</span><span class="dv">55</span>   Min.   <span class="sc">:</span> <span class="fl">80.0</span>   Min.   <span class="sc">:</span> <span class="fl">55.00</span>   no  <span class="sc">:</span><span class="dv">37</span>   Min.   <span class="sc">:</span><span class="fl">26.00</span>   A<span class="sc">:</span><span class="dv">33</span>  </span>
<span id="cb153-4"><a href="data-processing.html#cb153-4" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="dv">2879</span>   male  <span class="sc">:</span><span class="dv">45</span>   1st Qu.<span class="sc">:</span><span class="fl">121.0</span>   1st Qu.<span class="sc">:</span> <span class="fl">80.00</span>   yes <span class="sc">:</span><span class="dv">43</span>   1st Qu.<span class="sc">:</span><span class="fl">39.75</span>   B<span class="sc">:</span><span class="dv">36</span>  </span>
<span id="cb153-5"><a href="data-processing.html#cb153-5" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="dv">5237</span>               Median <span class="sc">:</span><span class="fl">148.5</span>   Median <span class="sc">:</span> <span class="fl">96.00</span>   NA<span class="st">&#39;s:20   Median :50.00   C:31  </span></span>
<span id="cb153-6"><a href="data-processing.html#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="st"> Mean   :5227               Mean   :154.3   Mean   : 98.51             Mean   :48.71         </span></span>
<span id="cb153-7"><a href="data-processing.html#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="st"> 3rd Qu.:7309               3rd Qu.:184.0   3rd Qu.:116.25             3rd Qu.:58.00         </span></span>
<span id="cb153-8"><a href="data-processing.html#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="st"> Max.   :9962               Max.   :238.0   Max.   :158.00             Max.   :71.00         </span></span>
<span id="cb153-9"><a href="data-processing.html#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; salt_ht_centers[1:10, ]</span></span>
<span id="cb153-10"><a href="data-processing.html#cb153-10" aria-hidden="true" tabindex="-1"></a><span class="st">     ID    sex sbp dbp saltadd age Center</span></span>
<span id="cb153-11"><a href="data-processing.html#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="st">1  1006   male 192 118      no  42      A</span></span>
<span id="cb153-12"><a href="data-processing.html#cb153-12" aria-hidden="true" tabindex="-1"></a><span class="st">2  1024 female 178 128     yes  63      C</span></span>
<span id="cb153-13"><a href="data-processing.html#cb153-13" aria-hidden="true" tabindex="-1"></a><span class="st">3  1086 female 160 108     yes  47      A</span></span>
<span id="cb153-14"><a href="data-processing.html#cb153-14" aria-hidden="true" tabindex="-1"></a><span class="st">4  1219 female 148 108     yes  55      A</span></span>
<span id="cb153-15"><a href="data-processing.html#cb153-15" aria-hidden="true" tabindex="-1"></a><span class="st">5  1457   male 170  98      no  66      A</span></span>
<span id="cb153-16"><a href="data-processing.html#cb153-16" aria-hidden="true" tabindex="-1"></a><span class="st">6  1511 female 149  94      no  48      B</span></span>
<span id="cb153-17"><a href="data-processing.html#cb153-17" aria-hidden="true" tabindex="-1"></a><span class="st">7  1598   male 118  72      no  52      B</span></span>
<span id="cb153-18"><a href="data-processing.html#cb153-18" aria-hidden="true" tabindex="-1"></a><span class="st">8  1635 female 115  73     yes  40      C</span></span>
<span id="cb153-19"><a href="data-processing.html#cb153-19" aria-hidden="true" tabindex="-1"></a><span class="st">9  1640   male 171 105     yes  53      B</span></span>
<span id="cb153-20"><a href="data-processing.html#cb153-20" aria-hidden="true" tabindex="-1"></a><span class="st">10 1684   male 184  98    &lt;NA&gt;  58      B</span></span></code></pre></div>
<p>And this works: as we see here, we still have 55 women and 45 men, but we also have the extra variable <tt>Center</tt>, which breaks down roughly equally across <code>A</code>, <code>B</code> and <code>C</code>, with no missing values.</p>
<p><strong>Example: adding rows and columns</strong> In contrast, we can request that all rows from both data sets are kept in the merged data frame, simply by also setting <code>all.y = TRUE</code>.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="data-processing.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> salt_ht_centers_all <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> salt_ht, <span class="at">y =</span> centers, <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2"><a href="data-processing.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(salt_ht_centers_all)</span>
<span id="cb154-3"><a href="data-processing.html#cb154-3" aria-hidden="true" tabindex="-1"></a>       ID           sex          sbp             dbp         saltadd        age        Center</span>
<span id="cb154-4"><a href="data-processing.html#cb154-4" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="dv">1006</span>   female<span class="sc">:</span><span class="dv">55</span>   Min.   <span class="sc">:</span> <span class="fl">80.0</span>   Min.   <span class="sc">:</span> <span class="fl">55.00</span>   no  <span class="sc">:</span><span class="dv">37</span>   Min.   <span class="sc">:</span><span class="fl">26.00</span>   A<span class="sc">:</span><span class="dv">56</span>  </span>
<span id="cb154-5"><a href="data-processing.html#cb154-5" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="dv">2787</span>   male  <span class="sc">:</span><span class="dv">45</span>   1st Qu.<span class="sc">:</span><span class="fl">121.0</span>   1st Qu.<span class="sc">:</span> <span class="fl">80.00</span>   yes <span class="sc">:</span><span class="dv">43</span>   1st Qu.<span class="sc">:</span><span class="fl">39.75</span>   B<span class="sc">:</span><span class="dv">57</span>  </span>
<span id="cb154-6"><a href="data-processing.html#cb154-6" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="dv">5527</span>   NA<span class="st">&#39;s  :50   Median :148.5   Median : 96.00   NA&#39;</span>s<span class="sc">:</span><span class="dv">70</span>   Median <span class="sc">:</span><span class="fl">50.00</span>   C<span class="sc">:</span><span class="dv">37</span>  </span>
<span id="cb154-7"><a href="data-processing.html#cb154-7" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="dv">5367</span>               Mean   <span class="sc">:</span><span class="fl">154.3</span>   Mean   <span class="sc">:</span> <span class="fl">98.51</span>             Mean   <span class="sc">:</span><span class="fl">48.71</span>         </span>
<span id="cb154-8"><a href="data-processing.html#cb154-8" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="dv">7754</span>               3rd Qu.<span class="sc">:</span><span class="fl">184.0</span>   3rd Qu.<span class="sc">:</span><span class="fl">116.25</span>             3rd Qu.<span class="sc">:</span><span class="fl">58.00</span>         </span>
<span id="cb154-9"><a href="data-processing.html#cb154-9" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="dv">9962</span>               Max.   <span class="sc">:</span><span class="fl">238.0</span>   Max.   <span class="sc">:</span><span class="fl">158.00</span>             Max.   <span class="sc">:</span><span class="fl">71.00</span>         </span>
<span id="cb154-10"><a href="data-processing.html#cb154-10" aria-hidden="true" tabindex="-1"></a>                            NA<span class="st">&#39;s   :50      NA&#39;</span>s   <span class="sc">:</span><span class="dv">50</span>                 NA<span class="st">&#39;s   :50            </span></span>
<span id="cb154-11"><a href="data-processing.html#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; salt_ht_centers_all[1:10, ]</span></span>
<span id="cb154-12"><a href="data-processing.html#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="st">     ID    sex sbp dbp saltadd age Center</span></span>
<span id="cb154-13"><a href="data-processing.html#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="st">1  1006   male 192 118      no  42      A</span></span>
<span id="cb154-14"><a href="data-processing.html#cb154-14" aria-hidden="true" tabindex="-1"></a><span class="st">2  1014   &lt;NA&gt;  NA  NA    &lt;NA&gt;  NA      B</span></span>
<span id="cb154-15"><a href="data-processing.html#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="st">3  1024 female 178 128     yes  63      C</span></span>
<span id="cb154-16"><a href="data-processing.html#cb154-16" aria-hidden="true" tabindex="-1"></a><span class="st">4  1086 female 160 108     yes  47      A</span></span>
<span id="cb154-17"><a href="data-processing.html#cb154-17" aria-hidden="true" tabindex="-1"></a><span class="st">5  1162   &lt;NA&gt;  NA  NA    &lt;NA&gt;  NA      B</span></span>
<span id="cb154-18"><a href="data-processing.html#cb154-18" aria-hidden="true" tabindex="-1"></a><span class="st">6  1219 female 148 108     yes  55      A</span></span>
<span id="cb154-19"><a href="data-processing.html#cb154-19" aria-hidden="true" tabindex="-1"></a><span class="st">7  1265   &lt;NA&gt;  NA  NA    &lt;NA&gt;  NA      A</span></span>
<span id="cb154-20"><a href="data-processing.html#cb154-20" aria-hidden="true" tabindex="-1"></a><span class="st">8  1457   male 170  98      no  66      A</span></span>
<span id="cb154-21"><a href="data-processing.html#cb154-21" aria-hidden="true" tabindex="-1"></a><span class="st">9  1458   &lt;NA&gt;  NA  NA    &lt;NA&gt;  NA      A</span></span>
<span id="cb154-22"><a href="data-processing.html#cb154-22" aria-hidden="true" tabindex="-1"></a><span class="st">10 1511 female 149  94      no  48      B</span></span></code></pre></div>
<p>Looking at the resulting data frame, we see the same columns (including <code>Center</code>) as before, but now also have missing values for all variables except <code>ID</code> and <code>Center</code>: these are precisely new 50 missing values in the blood pressure- and demographic variables for subjects who are part of <tt>center</tt>, but not <tt>salt_ht</tt>. This kind of merging known as a <em>full</em> or <em>outer</em> join.</p>
</div>
<div id="general-pipeline" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Using pipelines<a href="data-processing.html#general-pipeline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>UNDER CONSTRUCTION</p>
</div>
<div id="next-steps" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Next steps<a href="data-processing.html#next-steps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For an alternative approach to data processing, group- and otherwise, see Section <a href="data-tidyverse.html#data-tidyverse">7</a>.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="18">
<li id="fn18"><p>This is called a <em>named vector</em>, and works quite similar to named lists we have already discussed: we can still use the basic indexing methods (by position, logical), but we can also use the names to reference elements of the vector. We have already seen examples of named vectors without knowing it, namely the result of calling <code>summary</code> for a basic vector. FIXME: example?<a href="data-processing.html#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p>Everywhere the object <code>MeanSd</code> is defined, actually.<a href="data-processing.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p>As described in Section @ref(named_lists)<a href="data-processing.html#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>Should your data set not include a unique identifier, one of your first steps should be to create a new variable that holds a unique identifier, e.g. as <code>mydata$newid &lt;- 1:nrow(mydata)</code>. And if anyone hands you multiple data sets without a shared unique identifier expecting you to merge them, you should complain loudly until they cough up one.<a href="data-processing.html#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p><code>setdiff</code> stands for <em>set difference</em>, as in, remove all elements of the second vector from the first one.<a href="data-processing.html#fnref22" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-types-struct.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-tidyverse.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/data_processing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["introductio-to-r.pdf", "introductio-to-r.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
