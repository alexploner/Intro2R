<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Processing data | Introduction to R</title>
  <meta name="description" content="This is the material for the course Introduction to R, given at Karolinska Institutet, Stockholm, Sweden, as part of the doctoral program in epidemiology." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Processing data | Introduction to R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the material for the course Introduction to R, given at Karolinska Institutet, Stockholm, Sweden, as part of the doctoral program in epidemiology." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Processing data | Introduction to R" />
  
  <meta name="twitter:description" content="This is the material for the course Introduction to R, given at Karolinska Institutet, Stockholm, Sweden, as part of the doctoral program in epidemiology." />
  



<meta name="date" content="2022-03-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-types-struct.html"/>
<link rel="next" href="data-tidyverse.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this document</a></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="1" data-path="background.html"><a href="background.html"><i class="fa fa-check"></i><b>1</b> Background</a>
<ul>
<li class="chapter" data-level="1.1" data-path="background.html"><a href="background.html#what-is-r"><i class="fa fa-check"></i><b>1.1</b> What is R?</a></li>
<li class="chapter" data-level="1.2" data-path="background.html"><a href="background.html#what-is-rstudio"><i class="fa fa-check"></i><b>1.2</b> What is RStudio?</a></li>
<li class="chapter" data-level="1.3" data-path="background.html"><a href="background.html#software-installation"><i class="fa fa-check"></i><b>1.3</b> Software installation</a></li>
<li class="chapter" data-level="1.4" data-path="background.html"><a href="background.html#references"><i class="fa fa-check"></i><b>1.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Working with R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#starting-r"><i class="fa fa-check"></i><b>2.1</b> Starting R</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#storing-data-as-objects"><i class="fa fa-check"></i><b>2.2</b> Storing data as objects</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction.html"><a href="introduction.html#about-variable-names"><i class="fa fa-check"></i><b>2.2.1</b> About variable names</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#data-structure-i-the-vector"><i class="fa fa-check"></i><b>2.3</b> Data structure I: The vector</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction.html"><a href="introduction.html#example-simple-descriptives"><i class="fa fa-check"></i><b>2.3.1</b> Example: simple descriptives</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction.html"><a href="introduction.html#example-simple-plots"><i class="fa fa-check"></i><b>2.3.2</b> Example: simple plots</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#non-numeric-data"><i class="fa fa-check"></i><b>2.4</b> Non-numeric data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introduction.html"><a href="introduction.html#descriptives-for-grouping-data"><i class="fa fa-check"></i><b>2.4.1</b> Descriptives for grouping data</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction.html"><a href="introduction.html#character-vector-vs-factor"><i class="fa fa-check"></i><b>2.4.2</b> Character vector vs factor</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#general-data-in-r"><i class="fa fa-check"></i><b>2.5</b> General data in R</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introduction.html"><a href="introduction.html#extracting-parts-of-a-data-frame"><i class="fa fa-check"></i><b>2.5.1</b> Extracting parts of a data frame</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction.html"><a href="introduction.html#example-descriptive-statistics"><i class="fa fa-check"></i><b>2.5.2</b> Example: descriptive statistics</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#importing-data"><i class="fa fa-check"></i><b>2.6</b> Importing data</a></li>
<li class="chapter" data-level="2.7" data-path="introduction.html"><a href="introduction.html#meta-activity"><i class="fa fa-check"></i><b>2.7</b> Meta-activity</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>2.7.1</b> Getting help</a></li>
<li class="chapter" data-level="2.7.2" data-path="introduction.html"><a href="introduction.html#keeping-track-of-objects"><i class="fa fa-check"></i><b>2.7.2</b> Keeping track of objects</a></li>
<li class="chapter" data-level="2.7.3" data-path="introduction.html"><a href="introduction.html#quitting-r"><i class="fa fa-check"></i><b>2.7.3</b> Quitting R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intro_rstudio.html"><a href="intro_rstudio.html"><i class="fa fa-check"></i><b>3</b> Working in RStudio</a>
<ul>
<li class="chapter" data-level="3.1" data-path="intro_rstudio.html"><a href="intro_rstudio.html#getting-started"><i class="fa fa-check"></i><b>3.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2" data-path="intro_rstudio.html"><a href="intro_rstudio.html#a-quick-tour-of-the-gui"><i class="fa fa-check"></i><b>3.2</b> A quick tour of the GUI</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="intro_rstudio.html"><a href="intro_rstudio.html#console-and-friends"><i class="fa fa-check"></i><b>3.2.1</b> Console and friends</a></li>
<li class="chapter" data-level="3.2.2" data-path="intro_rstudio.html"><a href="intro_rstudio.html#rstudio-console-specials"><i class="fa fa-check"></i><b>3.2.2</b> RStudio Console specials</a></li>
<li class="chapter" data-level="3.2.3" data-path="intro_rstudio.html"><a href="intro_rstudio.html#navigating-the-pane-layout"><i class="fa fa-check"></i><b>3.2.3</b> Navigating the pane layout</a></li>
<li class="chapter" data-level="3.2.4" data-path="intro_rstudio.html"><a href="intro_rstudio.html#the-default-upper-pane"><i class="fa fa-check"></i><b>3.2.4</b> The default upper pane</a></li>
<li class="chapter" data-level="3.2.5" data-path="intro_rstudio.html"><a href="intro_rstudio.html#the-default-lower-pane"><i class="fa fa-check"></i><b>3.2.5</b> The default lower pane</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="intro_rstudio.html"><a href="intro_rstudio.html#source-pane-scripting"><i class="fa fa-check"></i><b>3.3</b> Source pane &amp; scripting</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="intro_rstudio.html"><a href="intro_rstudio.html#console2source"><i class="fa fa-check"></i><b>3.3.1</b> From console to source</a></li>
<li class="chapter" data-level="3.3.2" data-path="intro_rstudio.html"><a href="intro_rstudio.html#the-source-pane-file-editor"><i class="fa fa-check"></i><b>3.3.2</b> The Source pane file editor</a></li>
<li class="chapter" data-level="3.3.3" data-path="intro_rstudio.html"><a href="intro_rstudio.html#displays"><i class="fa fa-check"></i><b>3.3.3</b> Displays</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="intro-example.html"><a href="intro-example.html"><i class="fa fa-check"></i><b>4</b> A simple example</a>
<ul>
<li class="chapter" data-level="4.1" data-path="intro-example.html"><a href="intro-example.html#data-import"><i class="fa fa-check"></i><b>4.1</b> Data import</a></li>
<li class="chapter" data-level="4.2" data-path="intro-example.html"><a href="intro-example.html#analysis"><i class="fa fa-check"></i><b>4.2</b> Analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="intro-example.html"><a href="intro-example.html#desc-ex"><i class="fa fa-check"></i><b>4.2.1</b> Descriptives</a></li>
<li class="chapter" data-level="4.2.2" data-path="intro-example.html"><a href="intro-example.html#blood-pressure-by-salt-intake"><i class="fa fa-check"></i><b>4.2.2</b> Blood pressure by salt intake</a></li>
<li class="chapter" data-level="4.2.3" data-path="intro-example.html"><a href="intro-example.html#salt-intake-by-sex"><i class="fa fa-check"></i><b>4.2.3</b> Salt intake by sex</a></li>
<li class="chapter" data-level="4.2.4" data-path="intro-example.html"><a href="intro-example.html#save-results"><i class="fa fa-check"></i><b>4.2.4</b> Save results</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="intro-example.html"><a href="intro-example.html#turning-into-script"><i class="fa fa-check"></i><b>4.3</b> Turning it into a script</a></li>
<li class="chapter" data-level="4.4" data-path="intro-example.html"><a href="intro-example.html#exp-res"><i class="fa fa-check"></i><b>4.4</b> Exporting results</a></li>
</ul></li>
<li class="part"><span><b>II Working with data</b></span></li>
<li class="chapter" data-level="5" data-path="data-types-struct.html"><a href="data-types-struct.html"><i class="fa fa-check"></i><b>5</b> Data types and structures</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-types-struct.html"><a href="data-types-struct.html#overview"><i class="fa fa-check"></i><b>5.1</b> Overview</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-types-struct.html"><a href="data-types-struct.html#data-examples"><i class="fa fa-check"></i><b>5.1.1</b> Data examples</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-types-struct.html"><a href="data-types-struct.html#background-1"><i class="fa fa-check"></i><b>5.2</b> Background</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-types-struct.html"><a href="data-types-struct.html#recap"><i class="fa fa-check"></i><b>5.2.1</b> Recap</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-types-struct.html"><a href="data-types-struct.html#motivation"><i class="fa fa-check"></i><b>5.2.2</b> Motivation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-types-struct.html"><a href="data-types-struct.html#more-about-vectors"><i class="fa fa-check"></i><b>5.3</b> More about vectors</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="data-types-struct.html"><a href="data-types-struct.html#vector-calculations"><i class="fa fa-check"></i><b>5.3.1</b> Vector calculations</a></li>
<li class="chapter" data-level="5.3.2" data-path="data-types-struct.html"><a href="data-types-struct.html#indexing-vectors-by-position"><i class="fa fa-check"></i><b>5.3.2</b> Indexing vectors by position</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="data-types-struct.html"><a href="data-types-struct.html#logical-data"><i class="fa fa-check"></i><b>5.4</b> Logical data</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-types-struct.html"><a href="data-types-struct.html#definition"><i class="fa fa-check"></i><b>5.4.1</b> Definition</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-types-struct.html"><a href="data-types-struct.html#logical-expressions"><i class="fa fa-check"></i><b>5.4.2</b> Logical expressions</a></li>
<li class="chapter" data-level="5.4.3" data-path="data-types-struct.html"><a href="data-types-struct.html#logical-vectors"><i class="fa fa-check"></i><b>5.4.3</b> Logical vectors</a></li>
<li class="chapter" data-level="5.4.4" data-path="data-types-struct.html"><a href="data-types-struct.html#logical-vectors-for-indexing"><i class="fa fa-check"></i><b>5.4.4</b> Logical vectors for indexing</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-types-struct.html"><a href="data-types-struct.html#more-on-rectangular-data"><i class="fa fa-check"></i><b>5.5</b> More on rectangular data</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-types-struct.html"><a href="data-types-struct.html#data-frame"><i class="fa fa-check"></i><b>5.5.1</b> Data frame</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-types-struct.html"><a href="data-types-struct.html#matrix"><i class="fa fa-check"></i><b>5.5.2</b> Matrix</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-types-struct.html"><a href="data-types-struct.html#extensions-alternatives"><i class="fa fa-check"></i><b>5.5.3</b> Extensions &amp; alternatives</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="data-types-struct.html"><a href="data-types-struct.html#helpers-subset-and-transform"><i class="fa fa-check"></i><b>5.6</b> Helpers: <code>subset</code> and <code>transform</code></a></li>
<li class="chapter" data-level="5.7" data-path="data-types-struct.html"><a href="data-types-struct.html#free-style-data-lists"><i class="fa fa-check"></i><b>5.7</b> Free-style data: lists</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="data-types-struct.html"><a href="data-types-struct.html#background-2"><i class="fa fa-check"></i><b>5.7.1</b> Background</a></li>
<li class="chapter" data-level="5.7.2" data-path="data-types-struct.html"><a href="data-types-struct.html#basic-list"><i class="fa fa-check"></i><b>5.7.2</b> Basic list</a></li>
<li class="chapter" data-level="5.7.3" data-path="data-types-struct.html"><a href="data-types-struct.html#named-lists"><i class="fa fa-check"></i><b>5.7.3</b> Named lists</a></li>
<li class="chapter" data-level="5.7.4" data-path="data-types-struct.html"><a href="data-types-struct.html#example-data-frames"><i class="fa fa-check"></i><b>5.7.4</b> Example: data frames</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="data-types-struct.html"><a href="data-types-struct.html#technical-notes"><i class="fa fa-check"></i><b>5.8</b> Technical notes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>6</b> Processing data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-processing.html"><a href="data-processing.html#overview-1"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="data-processing.html"><a href="data-processing.html#groupwise-statistics"><i class="fa fa-check"></i><b>6.2</b> Groupwise statistics</a></li>
<li class="chapter" data-level="6.3" data-path="data-processing.html"><a href="data-processing.html#using-your-own-functions"><i class="fa fa-check"></i><b>6.3</b> Using your own functions</a></li>
<li class="chapter" data-level="6.4" data-path="data-processing.html"><a href="data-processing.html#split---apply---combine"><i class="fa fa-check"></i><b>6.4</b> Split - Apply - Combine</a></li>
<li class="chapter" data-level="6.5" data-path="data-processing.html"><a href="data-processing.html#merging-data-sets"><i class="fa fa-check"></i><b>6.5</b> Merging data sets</a></li>
<li class="chapter" data-level="6.6" data-path="data-processing.html"><a href="data-processing.html#using-pipelines"><i class="fa fa-check"></i><b>6.6</b> Using pipelines</a></li>
<li class="chapter" data-level="6.7" data-path="data-processing.html"><a href="data-processing.html#technical-notes-1"><i class="fa fa-check"></i><b>6.7</b> Technical notes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-tidyverse.html"><a href="data-tidyverse.html"><i class="fa fa-check"></i><b>7</b> The <code>tidyverse</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-tidyverse.html"><a href="data-tidyverse.html#overview-2"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="data-tidyverse.html"><a href="data-tidyverse.html#using-dplyr-for-data-processing"><i class="fa fa-check"></i><b>7.2</b> Using <code>dplyr</code> for data processing</a></li>
</ul></li>
<li class="part"><span><b>III Estimation, inference, modelling</b></span></li>
<li class="chapter" data-level="8" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html"><i class="fa fa-check"></i><b>8</b> Basic Statistics &amp; Epidemiology</a>
<ul>
<li class="chapter" data-level="8.1" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#descriptives"><i class="fa fa-check"></i><b>8.1</b> Descriptives</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#distribution-characteristics"><i class="fa fa-check"></i><b>8.1.1</b> Distribution characteristics</a></li>
<li class="chapter" data-level="8.1.2" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#confidence-intervals"><i class="fa fa-check"></i><b>8.1.2</b> Confidence intervals</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#statistical-tests"><i class="fa fa-check"></i><b>8.2</b> Statistical tests</a></li>
<li class="chapter" data-level="8.3" data-path="basic-stats-epi.html"><a href="basic-stats-epi.html#epidemiological-risk-measures"><i class="fa fa-check"></i><b>8.3</b> Epidemiological risk measures</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="regression_linear.html"><a href="regression_linear.html"><i class="fa fa-check"></i><b>9</b> Linear regression</a>
<ul>
<li class="chapter" data-level="9.1" data-path="regression_linear.html"><a href="regression_linear.html#overview-3"><i class="fa fa-check"></i><b>9.1</b> Overview</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="regression_linear.html"><a href="regression_linear.html#data-example-hemoglobin"><i class="fa fa-check"></i><b>9.1.1</b> Data example: Hemoglobin</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="regression_linear.html"><a href="regression_linear.html#background-3"><i class="fa fa-check"></i><b>9.2</b> Background</a></li>
<li class="chapter" data-level="9.3" data-path="regression_linear.html"><a href="regression_linear.html#simple-linear-regression"><i class="fa fa-check"></i><b>9.3</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="regression_linear.html"><a href="regression_linear.html#looking-at-the-data"><i class="fa fa-check"></i><b>9.3.1</b> Looking at the data</a></li>
<li class="chapter" data-level="9.3.2" data-path="regression_linear.html"><a href="regression_linear.html#fitting-a-linear-regression-model"><i class="fa fa-check"></i><b>9.3.2</b> Fitting a linear regression model</a></li>
<li class="chapter" data-level="9.3.3" data-path="regression_linear.html"><a href="regression_linear.html#regression-table-and-inference"><i class="fa fa-check"></i><b>9.3.3</b> Regression table and inference</a></li>
<li class="chapter" data-level="9.3.4" data-path="regression_linear.html"><a href="regression_linear.html#prediction"><i class="fa fa-check"></i><b>9.3.4</b> Prediction</a></li>
<li class="chapter" data-level="9.3.5" data-path="regression_linear.html"><a href="regression_linear.html#diagnostics"><i class="fa fa-check"></i><b>9.3.5</b> Diagnostics</a></li>
<li class="chapter" data-level="9.3.6" data-path="regression_linear.html"><a href="regression_linear.html#binary-predictor-and-dummy-coding"><i class="fa fa-check"></i><b>9.3.6</b> Binary predictor and dummy coding</a></li>
<li class="chapter" data-level="9.3.7" data-path="regression_linear.html"><a href="regression_linear.html#aside-generating-nice-regression-tables"><i class="fa fa-check"></i><b>9.3.7</b> Aside: generating nice regression tables</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="regression_linear.html"><a href="regression_linear.html#multiple-linear-regression"><i class="fa fa-check"></i><b>9.4</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="regression_linear.html"><a href="regression_linear.html#multiple-predictors"><i class="fa fa-check"></i><b>9.4.1</b> Multiple predictors</a></li>
<li class="chapter" data-level="9.4.2" data-path="regression_linear.html"><a href="regression_linear.html#categorical-predictors-with-2-levels"><i class="fa fa-check"></i><b>9.4.2</b> Categorical predictors with <span class="math inline">\(&gt;\)</span> 2 levels</a></li>
<li class="chapter" data-level="9.4.3" data-path="regression_linear.html"><a href="regression_linear.html#interactions"><i class="fa fa-check"></i><b>9.4.3</b> Interactions</a></li>
<li class="chapter" data-level="9.4.4" data-path="regression_linear.html"><a href="regression_linear.html#splines"><i class="fa fa-check"></i><b>9.4.4</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="regression_linear.html"><a href="regression_linear.html#technical-notes-2"><i class="fa fa-check"></i><b>9.5</b> Technical notes</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="regression_more.html"><a href="regression_more.html"><i class="fa fa-check"></i><b>10</b> More regression models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="regression_more.html"><a href="regression_more.html#logistic-regression"><i class="fa fa-check"></i><b>10.1</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="regression_more.html"><a href="regression_more.html#ex.-birthweight-uterine-irritability"><i class="fa fa-check"></i><b>10.1.1</b> Ex.: Birthweight &amp; uterine irritability</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="regression_more.html"><a href="regression_more.html#survival-regression"><i class="fa fa-check"></i><b>10.2</b> Survival regression</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="regression_more.html"><a href="regression_more.html#survival-data"><i class="fa fa-check"></i><b>10.2.1</b> Survival data</a></li>
<li class="chapter" data-level="10.2.2" data-path="regression_more.html"><a href="regression_more.html#survival-curves"><i class="fa fa-check"></i><b>10.2.2</b> Survival curves</a></li>
<li class="chapter" data-level="10.2.3" data-path="regression_more.html"><a href="regression_more.html#cox-regression"><i class="fa fa-check"></i><b>10.2.3</b> Cox regression</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="regression_more.html"><a href="regression_more.html#other-models"><i class="fa fa-check"></i><b>10.3</b> Other models</a></li>
</ul></li>
<li class="part"><span><b>IV Graphics</b></span></li>
<li class="chapter" data-level="11" data-path="graphics_base.html"><a href="graphics_base.html"><i class="fa fa-check"></i><b>11</b> Graphics in base R</a>
<ul>
<li class="chapter" data-level="11.1" data-path="graphics_base.html"><a href="graphics_base.html#overview-4"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="graphics_base.html"><a href="graphics_base.html#base-plots"><i class="fa fa-check"></i><b>11.2</b> Base plots</a>
<ul>
<li class="chapter" data-level="" data-path="graphics_base.html"><a href="graphics_base.html#vectorized-graphical-parameters"><i class="fa fa-check"></i>Vectorized graphical parameters</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="graphics_base.html"><a href="graphics_base.html#low-level-and-high-level-plotting"><i class="fa fa-check"></i><b>11.3</b> Low-level and high-level plotting</a></li>
<li class="chapter" data-level="11.4" data-path="graphics_base.html"><a href="graphics_base.html#displaying-saving-coloring-plots"><i class="fa fa-check"></i><b>11.4</b> Displaying, saving, coloring plots</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html"><i class="fa fa-check"></i><b>12</b> Graphics using <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="12.1" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#overview-5"><i class="fa fa-check"></i><b>12.1</b> Overview</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#data-example-hemoglobin-1"><i class="fa fa-check"></i><b>12.1.1</b> Data example: Hemoglobin</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#background-4"><i class="fa fa-check"></i><b>12.2</b> Background</a></li>
<li class="chapter" data-level="12.3" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#concepts"><i class="fa fa-check"></i><b>12.3</b> Concepts</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#aesthetics"><i class="fa fa-check"></i><b>12.3.1</b> Aesthetics</a></li>
<li class="chapter" data-level="12.3.2" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#example-data"><i class="fa fa-check"></i><b>12.3.2</b> Example data</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#background-5"><i class="fa fa-check"></i><b>12.4</b> Background</a></li>
<li class="chapter" data-level="12.5" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#basic-usage"><i class="fa fa-check"></i><b>12.5</b> Basic usage</a></li>
<li class="chapter" data-level="12.6" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#slightly-extended-usage"><i class="fa fa-check"></i><b>12.6</b> Slightly extended usage</a></li>
<li class="chapter" data-level="12.7" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#multiple-layers"><i class="fa fa-check"></i><b>12.7</b> Multiple layers</a></li>
<li class="chapter" data-level="12.8" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#splitting-the-plot"><i class="fa fa-check"></i><b>12.8</b> Splitting the plot</a></li>
<li class="chapter" data-level="12.9" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#messing-with-the-defaults"><i class="fa fa-check"></i><b>12.9</b> Messing with the defaults</a>
<ul>
<li class="chapter" data-level="12.9.1" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#fixing-aesthetics"><i class="fa fa-check"></i><b>12.9.1</b> {-} Fixing aesthetics</a></li>
<li class="chapter" data-level="" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#scales"><i class="fa fa-check"></i>Scales</a></li>
</ul></li>
<li class="chapter" data-level="12.10" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#messing-with-defaults-ii-themes"><i class="fa fa-check"></i><b>12.10</b> Messing with defaults II: themes</a></li>
<li class="chapter" data-level="12.11" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#extension-packages"><i class="fa fa-check"></i><b>12.11</b> Extension packages</a></li>
<li class="chapter" data-level="12.12" data-path="graphics_ggplot2.html"><a href="graphics_ggplot2.html#technical-notes-3"><i class="fa fa-check"></i><b>12.12</b> Technical notes</a></li>
</ul></li>
<li class="part"><span><b>V Organizing the analysis</b></span></li>
<li class="chapter" data-level="13" data-path="tables_nice.html"><a href="tables_nice.html"><i class="fa fa-check"></i><b>13</b> Generating nice tables</a></li>
<li class="chapter" data-level="14" data-path="dynamic_documents.html"><a href="dynamic_documents.html"><i class="fa fa-check"></i><b>14</b> Dynamic documents</a></li>
<li class="chapter" data-level="15" data-path="scripting-workflow.html"><a href="scripting-workflow.html"><i class="fa fa-check"></i><b>15</b> Scripting and workflow</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-processing" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Processing data</h1>
<div id="overview-1" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Overview</h2>
<p>The previous section has already covered a central aspect of data handling in base R: how to extract and change parts of a data frame, using either the bracket- or <code>$</code>-notations, or the helper functions <code>subset</code> and <code>transform</code>.</p>
<p>However, as we have already seen in the introductory example in Section 4, this offers only a crude solution for working with <em>groups</em> of observations, by explicitly splitting the original data frame into subsets: for many applications, this type of data replication is unnecessary and inefficient. On the other hand, in situations where we actually do want to split a data frame into subsets, a manual approach via <code>subset</code> or similar can be tedious if there are more than a few groups. FIXME: reference</p>
<p>We have also not looked at the opposite situation, where do not want to split an exisiting data set, but rather extract and combine information from multiple data sets into one, a very common step in data processing, e.g. when working with register data.</p>
<p>For examples, we will use again the data on blood pressure and salt consumption in 100 subjects: FIXME reference</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="data-processing.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">head</span>(salt_ht, <span class="at">nrow =</span> <span class="dv">5</span>)</span>
<span id="cb122-2"><a href="data-processing.html#cb122-2" aria-hidden="true" tabindex="-1"></a>    ID    sex sbp dbp saltadd age</span>
<span id="cb122-3"><a href="data-processing.html#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">4305</span>   male <span class="dv">110</span>  <span class="dv">80</span>     yes  <span class="dv">58</span></span>
<span id="cb122-4"><a href="data-processing.html#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">6606</span> female  <span class="dv">85</span>  <span class="dv">55</span>      no  <span class="dv">32</span></span>
<span id="cb122-5"><a href="data-processing.html#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">5758</span> female <span class="dv">196</span> <span class="dv">128</span>    <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">53</span></span>
<span id="cb122-6"><a href="data-processing.html#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">2265</span>   male <span class="dv">167</span> <span class="dv">112</span>     yes  <span class="dv">68</span></span>
<span id="cb122-7"><a href="data-processing.html#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">7408</span> female <span class="dv">145</span> <span class="dv">110</span>     yes  <span class="dv">55</span></span>
<span id="cb122-8"><a href="data-processing.html#cb122-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">2160</span> female <span class="dv">179</span> <span class="dv">120</span>      no  <span class="dv">60</span></span></code></pre></div>
<p>As before, this section will only deal with methods from base R. For a demonstration of how to achieve the same tasks using the package <code>dplyr</code> that is part of the tidyverse, see section FIXME ref.</p>
</div>
<div id="groupwise-statistics" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Groupwise statistics</h2>
<p>For calculating descriptive statistics for distinct groups of subjects, we can use the function <code>aggregate</code>, which works well with data frames and offers a formula interface, making it quite intuitive to use. As we will see below, <code>aggregate</code> is a powerful tool that allows for multiple grouping levels, multiple outcome variables, and flexible summaries.</p>
<p>We will start however with a simple example, with one outcome variable of interest, a single grouping variable, and standard summary statistics. Specifically, we want to calculate the the average systolic blood pressure in our example data separately for males and females:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="data-processing.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, mean)</span>
<span id="cb123-2"><a href="data-processing.html#cb123-2" aria-hidden="true" tabindex="-1"></a>     sex      sbp</span>
<span id="cb123-3"><a href="data-processing.html#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.8182</span></span>
<span id="cb123-4"><a href="data-processing.html#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.0444</span></span></code></pre></div>
<p>The variable to be aggregated, the systolic blood pressure <code>sbp</code>, is shown on the left hand side of the formula, the grouping variable <code>sex</code> is on the right hand side, the data frame where these variables are taken from is specified via the <code>data</code>-argument, and the third argument is the function to apply to the dependent variable in each group, here the <code>mean</code>. For our example, this gives us a mean of about 158 mmHg for women, and about 150 mmHg for men.</p>
<p>This can be easiliy modified to calculate the standard deviation of the systolic blood pressure in each group, simply by plugging in the function <code>sd</code> instead of <code>mean</code>:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="data-processing.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, sd)</span>
<span id="cb124-2"><a href="data-processing.html#cb124-2" aria-hidden="true" tabindex="-1"></a>     sex      sbp</span>
<span id="cb124-3"><a href="data-processing.html#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">43.24482</span></span>
<span id="cb124-4"><a href="data-processing.html#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">33.81632</span></span></code></pre></div>
<p>Here we see that women also have higher variability in systolic blood pressure than men.</p>
<p>This basic approach can now be extended in several ways. To start with, we can use a <em>more complicated summary</em> function: <code>MeanCI</code> in package <code>DescTools</code> returns the mean and (by default) 95% confidence interval for a vector of numerical values.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="data-processing.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(DescTools)</span>
<span id="cb125-2"><a href="data-processing.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, MeanCI)</span>
<span id="cb125-3"><a href="data-processing.html#cb125-3" aria-hidden="true" tabindex="-1"></a>     sex sbp.mean sbp.lwr.ci sbp.upr.ci</span>
<span id="cb125-4"><a href="data-processing.html#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.8182</span>   <span class="fl">146.1275</span>   <span class="fl">169.5089</span></span>
<span id="cb125-5"><a href="data-processing.html#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.0444</span>   <span class="fl">139.8849</span>   <span class="fl">160.2040</span></span></code></pre></div>
<p>The result from this function call has now four columns, one grouping variable and the three columns showing the mean and confidence interval limits for the systolic blood pressure in each group.<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a></p>
<p>We can also specify <em>multiple grouping variables</em> on the right hand side of the formula, by listing them separated by a <code>+</code>-sign. This will evaluate the specified summary function for all observed combinations of groups in the data set. So if we want to compare the mean systolica blood pressure between male and female salt-adders and non-salt adders, we can do this:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="data-processing.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex <span class="sc">+</span> saltadd, <span class="at">data =</span> salt_ht, mean)</span>
<span id="cb126-2"><a href="data-processing.html#cb126-2" aria-hidden="true" tabindex="-1"></a>     sex saltadd      sbp</span>
<span id="cb126-3"><a href="data-processing.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female      no <span class="fl">133.7692</span></span>
<span id="cb126-4"><a href="data-processing.html#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male      no <span class="fl">139.4167</span></span>
<span id="cb126-5"><a href="data-processing.html#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> female     yes <span class="fl">164.4643</span></span>
<span id="cb126-6"><a href="data-processing.html#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   male     yes <span class="fl">160.2667</span></span></code></pre></div>
<p>Here, the output shows two grouping variables, corresponding to the right hand side of the formula, and one summary column.<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a></p>
<p>As an aside, this is actually quite interesting: as we saw above, just comparing males and females without reference to salt-adding habits, we find that the females have a higher systolic blood pressure by about eight points, but when we break it down by salt-adding, we see that females actually have a <em>lower</em> blood pressure in the non-salt group, by almost six points, and only a slightly higher blood pressure among the salt-adders, 164 vs 160. So we can already tell here that there must be more salt-adders among the women, otherwise, this would not work.</p>
<p>We can also do on-the-fly transformations of the outcome variable, so here we calculate the averages of the logarithmised blood pressures:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="data-processing.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(<span class="fu">log</span>(sbp) <span class="sc">~</span> sex <span class="sc">+</span> saltadd, <span class="at">data =</span> salt_ht, mean)</span>
<span id="cb128-2"><a href="data-processing.html#cb128-2" aria-hidden="true" tabindex="-1"></a>     sex saltadd <span class="fu">log</span>(sbp)</span>
<span id="cb128-3"><a href="data-processing.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female      no <span class="fl">4.862900</span></span>
<span id="cb128-4"><a href="data-processing.html#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male      no <span class="fl">4.921043</span></span>
<span id="cb128-5"><a href="data-processing.html#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> female     yes <span class="fl">5.067426</span></span>
<span id="cb128-6"><a href="data-processing.html#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   male     yes <span class="fl">5.052278</span></span></code></pre></div>
<p>Note that this will work in general with the R formula notation.</p>
<p>Finally, we can process multiple outcome variables at the same time by specifying them on the left hand side, by calling the function <code>cbind</code> (<em>column-bind</em>), which combines the columns we want to average into an object suitable for the left hand side of a formula<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a>. And as we see, this works, too.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="data-processing.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(<span class="fu">cbind</span>(sbp, dbp) <span class="sc">~</span> sex <span class="sc">+</span> saltadd, <span class="at">data =</span> salt_ht, mean)</span>
<span id="cb129-2"><a href="data-processing.html#cb129-2" aria-hidden="true" tabindex="-1"></a>     sex saltadd      sbp       dbp</span>
<span id="cb129-3"><a href="data-processing.html#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female      no <span class="fl">133.7692</span>  <span class="fl">86.30769</span></span>
<span id="cb129-4"><a href="data-processing.html#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male      no <span class="fl">139.4167</span>  <span class="fl">90.33333</span></span>
<span id="cb129-5"><a href="data-processing.html#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> female     yes <span class="fl">164.4643</span> <span class="fl">106.17857</span></span>
<span id="cb129-6"><a href="data-processing.html#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   male     yes <span class="fl">160.2667</span> <span class="fl">102.40000</span></span></code></pre></div>
</div>
<div id="using-your-own-functions" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Using your own functions</h2>
<p>What if we want to calculate the mean and standard deviation at the same time, instead of running aggregate twice? Then we need to find a function that a. takes as argument a numerical vector, and b. returns a vector of length two, with the mean as first element and the standard deviation as second. Now I am convinced that somewhere among the ca. 19,000 packages on CRAN, there is one that contains just such a function, but actually finding the package and the function will be difficult - indeed, a much simpler solution is to <em>write your own function</em>.</p>
<p>Think of functions as recipies: ingredients go in, some processing takes place, and a delicious meal is returned. We are not bound by what is implemented in base R, or in a package, we can cook our own meals. Let me show you.</p>
<p>Let’s start with a trivial example, where we write a wrapper for the mean function. Instead of calling mean directly, we define a function with one argument x, which performs one action, namely calculating the mean value of x, and which returns that mean value as result. We can run this, and it works correctly. So the principle is sound.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="data-processing.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, <span class="cf">function</span>(x) <span class="fu">mean</span>(x))</span>
<span id="cb130-2"><a href="data-processing.html#cb130-2" aria-hidden="true" tabindex="-1"></a>     sex      sbp</span>
<span id="cb130-3"><a href="data-processing.html#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.8182</span></span>
<span id="cb130-4"><a href="data-processing.html#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.0444</span></span></code></pre></div>
<p>So I use the same approach, the same call to aggregate, starting with the same function definition, and the same argument x, but now I do something more complicated: I calculate the mean of x, as before, but also the standard deviation of x, using the function sd. And we know already how to combine two unrelated numbers into a vector, we use the function c(). And this is what we use here.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="data-processing.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="fu">mean</span>(x), <span class="fu">sd</span>(x)))</span>
<span id="cb131-2"><a href="data-processing.html#cb131-2" aria-hidden="true" tabindex="-1"></a>     sex     sbp<span class="fl">.1</span>     sbp<span class="fl">.2</span></span>
<span id="cb131-3"><a href="data-processing.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.81818</span>  <span class="fl">43.24482</span></span>
<span id="cb131-4"><a href="data-processing.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.04444</span>  <span class="fl">33.81632</span></span></code></pre></div>
<p>And this works as planned: for each level of sex, I get now two numbers, the first of which is the mean of the systolic blood pressure, and the second is the standard deviation. Almost perfect, though the column names here are not pretty, and worse, not informative.</p>
<p>So let’s take this one step further, and let’s slap some names on the components of this vector. We call the first Mean, for obvious reasons, and the second StdDev, for brevity. This is a valid way of calling the c-function, and the result is still a vector of length two, but now with names<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a>. And this works, and we have some reasonable output here.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="data-processing.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(x), <span class="at">StdDev =</span> <span class="fu">sd</span>(x)))</span>
<span id="cb132-2"><a href="data-processing.html#cb132-2" aria-hidden="true" tabindex="-1"></a>     sex  sbp.Mean sbp.StdDev</span>
<span id="cb132-3"><a href="data-processing.html#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.81818</span>   <span class="fl">43.24482</span></span>
<span id="cb132-4"><a href="data-processing.html#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.04444</span>   <span class="fl">33.81632</span></span></code></pre></div>
<p>So what do we do if we like this new function a lot, and want to use it widely? We can of course always type out the same function definition whenever we need it, but I think you’ll agree that this will get boring soon. Fortunately, we can save this function definition as an object, because R is not just functional, but also object-oriented. Here, I call the new object simply MeanSd.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="data-processing.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> MeanSd <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(x), <span class="at">StdDev =</span> <span class="fu">sd</span>(x))</span>
<span id="cb133-2"><a href="data-processing.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># This shows the function definition</span></span>
<span id="cb133-3"><a href="data-processing.html#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> MeanSd</span>
<span id="cb133-4"><a href="data-processing.html#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(x), <span class="at">StdDev =</span> <span class="fu">sd</span>(x))</span></code></pre></div>
<p>And this works exactly as before:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="data-processing.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">aggregate</span>(sbp <span class="sc">~</span> sex, <span class="at">data =</span> salt_ht, MeanSd)</span>
<span id="cb134-2"><a href="data-processing.html#cb134-2" aria-hidden="true" tabindex="-1"></a>     sex  sbp.Mean sbp.StdDev</span>
<span id="cb134-3"><a href="data-processing.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> female <span class="fl">157.81818</span>   <span class="fl">43.24482</span></span>
<span id="cb134-4"><a href="data-processing.html#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   male <span class="fl">150.04444</span>   <span class="fl">33.81632</span></span></code></pre></div>
<p>And the nice thing is, this function works everywhere, even outside of aggregate, so that is a bonus:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="data-processing.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">MeanSd</span>(salt_ht<span class="sc">$</span>sbp)</span>
<span id="cb135-2"><a href="data-processing.html#cb135-2" aria-hidden="true" tabindex="-1"></a>     Mean    StdDev </span>
<span id="cb135-3"><a href="data-processing.html#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="fl">154.32000</span>  <span class="fl">39.28628</span> </span></code></pre></div>
<p>So these were the last two points, here, we can define the function locally, just for the call to aggregate, or we can save it under a name and re-use as long as the object is around.</p>
</div>
<div id="split---apply---combine" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Split - Apply - Combine</h2>
<p><code>aggregate</code> works well for simple summary statistics like mean or median, and reasonably well for slightly more complex summary functions like <code>MeanCI</code> or our own <code>MeanSd</code>. However, for more complicated groupwise operations this becomes awkward. Let’s instead consider a more general mechanism that allows groupwise processing of any complexity, and which is well supported in a number of data processing languages. This is a three step process:</p>
<ol style="list-style-type: decimal">
<li><em>Split</em> the data into the groups you are interested in.</li>
<li><em>Apply</em> whatever processing or modelling function you want to run to the separate data chunks you have created in the first step.</li>
<li><em>Combine</em> the results from applying the function to the different data chunks into an informative ensemble.</li>
</ol>
<p>In base R, this can be implemented via a pair of functions, <code>split</code> and <code>lapply</code>, where</p>
<ul>
<li><p><code>split</code> takes as arguments a data frame and some grouping information, and returns a named list of data frames; each list element is a smaller data frame, with the same columns as the full data set, but only the rows corresponding to one group, so that the list has as many elements, as many sub-data frames, as there are grouping levels.</p></li>
<li><p><code>lapply</code> takes this list as first argument, together with the function we want to run on each sub-data frame as the second argument. <code>lapply</code> will run this for us, and collect the return values as a list of the same length as the input list.</p></li>
</ul>
<p>You will notice that there is no extra function for the combination step here: as we’ll see below, this can either be skipped, or implemented by a second call to <code>lapply</code>. With this approach, you can run any kind of per-group calculation, even if the output is complicated, like for regression models or statistical tests.</p>
<p>There is also a variant of called sapply, or simplified apply, which under some circumstances will be able to return not a list, but some nice rectangular object, as we’ll see in the examples.</p>
<p>So here we start by splitting the salt data frame into two, by levels of sex. The resulting object split_salt is a list of length two, as we can see, not very clearly in the console, but we can also look at the Envirnment tab, which is a bit better organized here. So we see indeed, this is a list with two elements, with names female and male, and each of them a data frame with same sex columns as the original data.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="data-processing.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> split_salt <span class="ot">&lt;-</span> <span class="fu">split</span>(salt_ht, salt_ht<span class="sc">$</span>sex)</span>
<span id="cb136-2"><a href="data-processing.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">str</span>(split_salt)</span>
<span id="cb136-3"><a href="data-processing.html#cb136-3" aria-hidden="true" tabindex="-1"></a>List of <span class="dv">2</span></span>
<span id="cb136-4"><a href="data-processing.html#cb136-4" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> female<span class="sc">:</span><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span> <span class="dv">55</span> obs. of  <span class="dv">6</span> variables<span class="sc">:</span></span>
<span id="cb136-5"><a href="data-processing.html#cb136-5" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> ID     <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">55</span>] <span class="dv">6606</span> <span class="dv">5758</span> <span class="dv">7408</span> <span class="dv">2160</span> <span class="dv">8202</span> <span class="dv">9571</span> <span class="dv">4767</span> <span class="dv">1024</span> <span class="dv">2627</span> <span class="dv">7707</span> ...</span>
<span id="cb136-6"><a href="data-processing.html#cb136-6" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> sex    <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span><span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb136-7"><a href="data-processing.html#cb136-7" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> sbp    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">55</span>] <span class="dv">85</span> <span class="dv">196</span> <span class="dv">145</span> <span class="dv">179</span> <span class="dv">110</span> <span class="dv">133</span> <span class="dv">149</span> <span class="dv">178</span> <span class="dv">126</span> <span class="dv">182</span> ...</span>
<span id="cb136-8"><a href="data-processing.html#cb136-8" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> dbp    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">55</span>] <span class="dv">55</span> <span class="dv">128</span> <span class="dv">110</span> <span class="dv">120</span> <span class="dv">70</span> <span class="dv">75</span> <span class="dv">72</span> <span class="dv">128</span> <span class="dv">78</span> <span class="dv">96</span> ...</span>
<span id="cb136-9"><a href="data-processing.html#cb136-9" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> saltadd<span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;no&quot;</span>,<span class="st">&quot;yes&quot;</span><span class="sc">:</span> <span class="dv">1</span> <span class="cn">NA</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">2</span> ...</span>
<span id="cb136-10"><a href="data-processing.html#cb136-10" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> age    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">55</span>] <span class="dv">32</span> <span class="dv">53</span> <span class="dv">55</span> <span class="dv">60</span> <span class="dv">32</span> <span class="dv">46</span> <span class="dv">63</span> <span class="dv">63</span> <span class="dv">46</span> <span class="dv">60</span> ...</span>
<span id="cb136-11"><a href="data-processing.html#cb136-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> male  <span class="sc">:</span><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span> <span class="dv">45</span> obs. of  <span class="dv">6</span> variables<span class="sc">:</span></span>
<span id="cb136-12"><a href="data-processing.html#cb136-12" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> ID     <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>] <span class="dv">4305</span> <span class="dv">2265</span> <span class="dv">8846</span> <span class="dv">9605</span> <span class="dv">4137</span> <span class="dv">1598</span> <span class="dv">9962</span> <span class="dv">1006</span> <span class="dv">7120</span> <span class="dv">6888</span> ...</span>
<span id="cb136-13"><a href="data-processing.html#cb136-13" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> sex    <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> ...</span>
<span id="cb136-14"><a href="data-processing.html#cb136-14" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> sbp    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>] <span class="dv">110</span> <span class="dv">167</span> <span class="dv">111</span> <span class="dv">198</span> <span class="dv">171</span> <span class="dv">118</span> <span class="dv">140</span> <span class="dv">192</span> <span class="dv">118</span> <span class="dv">121</span> ...</span>
<span id="cb136-15"><a href="data-processing.html#cb136-15" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> dbp    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>] <span class="dv">80</span> <span class="dv">112</span> <span class="dv">78</span> <span class="dv">119</span> <span class="dv">102</span> <span class="dv">72</span> <span class="dv">90</span> <span class="dv">118</span> <span class="dv">72</span> <span class="dv">86</span> ...</span>
<span id="cb136-16"><a href="data-processing.html#cb136-16" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> saltadd<span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;no&quot;</span>,<span class="st">&quot;yes&quot;</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb136-17"><a href="data-processing.html#cb136-17" aria-hidden="true" tabindex="-1"></a>  ..<span class="sc">$</span> age    <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>] <span class="dv">58</span> <span class="dv">68</span> <span class="dv">59</span> <span class="dv">63</span> <span class="dv">58</span> <span class="dv">52</span> <span class="dv">67</span> <span class="dv">42</span> <span class="dv">40</span> <span class="dv">36</span> ...</span></code></pre></div>
<p>And now we can process. Let’s start with <code>summary</code>, and indeed, we get the subset-specific summaries:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="data-processing.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_salt, summary)</span>
<span id="cb137-2"><a href="data-processing.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb137-3"><a href="data-processing.html#cb137-3" aria-hidden="true" tabindex="-1"></a>       ID           sex          sbp             dbp        saltadd  </span>
<span id="cb137-4"><a href="data-processing.html#cb137-4" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="dv">1024</span>   female<span class="sc">:</span><span class="dv">55</span>   Min.   <span class="sc">:</span> <span class="fl">80.0</span>   Min.   <span class="sc">:</span> <span class="fl">55.0</span>   no  <span class="sc">:</span><span class="dv">13</span>  </span>
<span id="cb137-5"><a href="data-processing.html#cb137-5" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="dv">2632</span>   male  <span class="sc">:</span> <span class="dv">0</span>   1st Qu.<span class="sc">:</span><span class="fl">121.5</span>   1st Qu.<span class="sc">:</span> <span class="fl">80.0</span>   yes <span class="sc">:</span><span class="dv">28</span>  </span>
<span id="cb137-6"><a href="data-processing.html#cb137-6" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="dv">5758</span>               Median <span class="sc">:</span><span class="fl">152.0</span>   Median <span class="sc">:</span><span class="fl">102.0</span>   NA<span class="st">&#39;s:14  </span></span>
<span id="cb137-7"><a href="data-processing.html#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="st"> Mean   :5256               Mean   :157.8   Mean   :100.8            </span></span>
<span id="cb137-8"><a href="data-processing.html#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="st"> 3rd Qu.:7536               3rd Qu.:194.5   3rd Qu.:119.0            </span></span>
<span id="cb137-9"><a href="data-processing.html#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="st"> Max.   :9899               Max.   :238.0   Max.   :158.0            </span></span>
<span id="cb137-10"><a href="data-processing.html#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="st">      age       </span></span>
<span id="cb137-11"><a href="data-processing.html#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="st"> Min.   :26.00  </span></span>
<span id="cb137-12"><a href="data-processing.html#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="st"> 1st Qu.:37.50  </span></span>
<span id="cb137-13"><a href="data-processing.html#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="st"> Median :48.00  </span></span>
<span id="cb137-14"><a href="data-processing.html#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="st"> Mean   :47.69  </span></span>
<span id="cb137-15"><a href="data-processing.html#cb137-15" aria-hidden="true" tabindex="-1"></a><span class="st"> 3rd Qu.:58.00  </span></span>
<span id="cb137-16"><a href="data-processing.html#cb137-16" aria-hidden="true" tabindex="-1"></a><span class="st"> Max.   :71.00  </span></span>
<span id="cb137-17"><a href="data-processing.html#cb137-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-18"><a href="data-processing.html#cb137-18" aria-hidden="true" tabindex="-1"></a><span class="st">$male</span></span>
<span id="cb137-19"><a href="data-processing.html#cb137-19" aria-hidden="true" tabindex="-1"></a><span class="st">       ID           sex          sbp           dbp         saltadd  </span></span>
<span id="cb137-20"><a href="data-processing.html#cb137-20" aria-hidden="true" tabindex="-1"></a><span class="st"> Min.   :1006   female: 0   Min.   :110   Min.   : 68.00   no  :24  </span></span>
<span id="cb137-21"><a href="data-processing.html#cb137-21" aria-hidden="true" tabindex="-1"></a><span class="st"> 1st Qu.:3210   male  :45   1st Qu.:121   1st Qu.: 82.00   yes :15  </span></span>
<span id="cb137-22"><a href="data-processing.html#cb137-22" aria-hidden="true" tabindex="-1"></a><span class="st"> Median :4592               Median :137   Median : 90.00   NA&#39;</span>s<span class="sc">:</span> <span class="dv">6</span>  </span>
<span id="cb137-23"><a href="data-processing.html#cb137-23" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="dv">5192</span>               Mean   <span class="sc">:</span><span class="dv">150</span>   Mean   <span class="sc">:</span> <span class="fl">95.71</span>            </span>
<span id="cb137-24"><a href="data-processing.html#cb137-24" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="dv">7120</span>               3rd Qu.<span class="sc">:</span><span class="dv">171</span>   3rd Qu.<span class="sc">:</span><span class="fl">110.00</span>            </span>
<span id="cb137-25"><a href="data-processing.html#cb137-25" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="dv">9962</span>               Max.   <span class="sc">:</span><span class="dv">225</span>   Max.   <span class="sc">:</span><span class="fl">150.00</span>            </span>
<span id="cb137-26"><a href="data-processing.html#cb137-26" aria-hidden="true" tabindex="-1"></a>      age       </span>
<span id="cb137-27"><a href="data-processing.html#cb137-27" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="fl">29.00</span>  </span>
<span id="cb137-28"><a href="data-processing.html#cb137-28" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="fl">41.00</span>  </span>
<span id="cb137-29"><a href="data-processing.html#cb137-29" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="fl">53.00</span>  </span>
<span id="cb137-30"><a href="data-processing.html#cb137-30" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="fl">49.96</span>  </span>
<span id="cb137-31"><a href="data-processing.html#cb137-31" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="fl">58.00</span>  </span>
<span id="cb137-32"><a href="data-processing.html#cb137-32" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="fl">68.00</span>  </span></code></pre></div>
<p>You may think that this looks very similar the manual splitting we have been doing so far, using the subset function. Not at all: there, we have to keep track of each level of the grouping variable ourselves, and each separate object we create. Here, this works the same whether the grouping variable has two or 18 levels, and the result is always one object, not two or 18 objects. And we don’t have to call summary 18 times, but only pass to lapply once. So this is definitely the way to go.</p>
<p>Let’s look at more complicated descriptive function, like descr from package summarytools. We can run descr, and we get a list with two descr output tables, one for males and one for females.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="data-processing.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(summarytools)</span>
<span id="cb138-2"><a href="data-processing.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_salt, descr)</span></code></pre></div>
<p>Note that we can use this mechanism to do something similar to aggregate: here, we use a simple function wrapper. The argument x for the function is a data frame, the part of the original data corresponding to single grouping level, and we can therefore extract the variable sbp with the $ notation, so, and pass this vector as argument to MeanCI. And this returns a list with two confidence intervals, one for females, one for males.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="data-processing.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">MeanCI</span>(x<span class="sc">$</span>sbp))</span>
<span id="cb139-2"><a href="data-processing.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb139-3"><a href="data-processing.html#cb139-3" aria-hidden="true" tabindex="-1"></a>    mean   lwr.ci   upr.ci </span>
<span id="cb139-4"><a href="data-processing.html#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="fl">157.8182</span> <span class="fl">146.1275</span> <span class="fl">169.5089</span> </span>
<span id="cb139-5"><a href="data-processing.html#cb139-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-6"><a href="data-processing.html#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb139-7"><a href="data-processing.html#cb139-7" aria-hidden="true" tabindex="-1"></a>    mean   lwr.ci   upr.ci </span>
<span id="cb139-8"><a href="data-processing.html#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="fl">150.0444</span> <span class="fl">139.8849</span> <span class="fl">160.2040</span> </span></code></pre></div>
<p>This is actually a sitation where the sapply functionc an do something nice for us. If we call it instead of lapply, but with the same arguments, sapply sees that the output from each of the function calls are just vectors of the same length, and combines them for us. This is almost useful, but I would prefer to have the grouping levels here as rows, not as columns. Fortunately, there exists the function t(), like transpose, which does exactly that, and we get something like the aggregate output.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="data-processing.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">MeanCI</span>(x<span class="sc">$</span>sbp))</span>
<span id="cb140-2"><a href="data-processing.html#cb140-2" aria-hidden="true" tabindex="-1"></a>         female     male</span>
<span id="cb140-3"><a href="data-processing.html#cb140-3" aria-hidden="true" tabindex="-1"></a>mean   <span class="fl">157.8182</span> <span class="fl">150.0444</span></span>
<span id="cb140-4"><a href="data-processing.html#cb140-4" aria-hidden="true" tabindex="-1"></a>lwr.ci <span class="fl">146.1275</span> <span class="fl">139.8849</span></span>
<span id="cb140-5"><a href="data-processing.html#cb140-5" aria-hidden="true" tabindex="-1"></a>upr.ci <span class="fl">169.5089</span> <span class="fl">160.2040</span></span>
<span id="cb140-6"><a href="data-processing.html#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb140-7"><a href="data-processing.html#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># We can even flip rows and columns with t()</span></span>
<span id="cb140-8"><a href="data-processing.html#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">t</span>(<span class="fu">sapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">MeanCI</span>(x<span class="sc">$</span>sbp)))</span>
<span id="cb140-9"><a href="data-processing.html#cb140-9" aria-hidden="true" tabindex="-1"></a>           mean   lwr.ci   upr.ci</span>
<span id="cb140-10"><a href="data-processing.html#cb140-10" aria-hidden="true" tabindex="-1"></a>female <span class="fl">157.8182</span> <span class="fl">146.1275</span> <span class="fl">169.5089</span></span>
<span id="cb140-11"><a href="data-processing.html#cb140-11" aria-hidden="true" tabindex="-1"></a>male   <span class="fl">150.0444</span> <span class="fl">139.8849</span> <span class="fl">160.2040</span></span></code></pre></div>
<p>So in this sense, split/sapply is the more general approach, but as you see, for simpler use cases like this example, it is a bit awkward, compared to aggregate. So there is space for both.</p>
<p>The split/lapply approach works especially well with functions that have a formula interface, as they have a data argument to specify the data frame from which to take the variables in the formula. So it is very easy to run e.g. groupwise t-tests, like here: we start with the split saltadd data, and we define a simple wrapper function, with one argument called x, as before, this is the sub-dataframe for each group, and then we feed this to the t.test-function as argument data. We specify the outcome variable, here again the systolic blood pressure, and the grouping variable, here the salt-add variable, and we can run this.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="data-processing.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">t.test</span>(sbp <span class="sc">~</span> saltadd, <span class="at">data =</span> x))</span>
<span id="cb141-2"><a href="data-processing.html#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb141-3"><a href="data-processing.html#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="data-processing.html#cb141-4" aria-hidden="true" tabindex="-1"></a>    Welch Two Sample t<span class="sc">-</span>test</span>
<span id="cb141-5"><a href="data-processing.html#cb141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-6"><a href="data-processing.html#cb141-6" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span>  sbp by saltadd</span>
<span id="cb141-7"><a href="data-processing.html#cb141-7" aria-hidden="true" tabindex="-1"></a>t <span class="ot">=</span> <span class="sc">-</span><span class="fl">2.4579</span>, df <span class="ot">=</span> <span class="fl">27.399</span>, p<span class="sc">-</span>value <span class="ot">=</span> <span class="fl">0.02058</span></span>
<span id="cb141-8"><a href="data-processing.html#cb141-8" aria-hidden="true" tabindex="-1"></a>alternative hypothesis<span class="sc">:</span> true difference <span class="cf">in</span> means between group no and group yes is not equal to <span class="dv">0</span></span>
<span id="cb141-9"><a href="data-processing.html#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="dv">95</span> percent confidence interval<span class="sc">:</span></span>
<span id="cb141-10"><a href="data-processing.html#cb141-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">-</span><span class="fl">56.301333</span>  <span class="sc">-</span><span class="fl">5.088777</span></span>
<span id="cb141-11"><a href="data-processing.html#cb141-11" aria-hidden="true" tabindex="-1"></a>sample estimates<span class="sc">:</span></span>
<span id="cb141-12"><a href="data-processing.html#cb141-12" aria-hidden="true" tabindex="-1"></a> mean <span class="cf">in</span> group no mean <span class="cf">in</span> group yes </span>
<span id="cb141-13"><a href="data-processing.html#cb141-13" aria-hidden="true" tabindex="-1"></a>         <span class="fl">133.7692</span>          <span class="fl">164.4643</span> </span>
<span id="cb141-14"><a href="data-processing.html#cb141-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-15"><a href="data-processing.html#cb141-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-16"><a href="data-processing.html#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb141-17"><a href="data-processing.html#cb141-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-18"><a href="data-processing.html#cb141-18" aria-hidden="true" tabindex="-1"></a>    Welch Two Sample t<span class="sc">-</span>test</span>
<span id="cb141-19"><a href="data-processing.html#cb141-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-20"><a href="data-processing.html#cb141-20" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span>  sbp by saltadd</span>
<span id="cb141-21"><a href="data-processing.html#cb141-21" aria-hidden="true" tabindex="-1"></a>t <span class="ot">=</span> <span class="sc">-</span><span class="fl">1.9155</span>, df <span class="ot">=</span> <span class="fl">23.455</span>, p<span class="sc">-</span>value <span class="ot">=</span> <span class="fl">0.0677</span></span>
<span id="cb141-22"><a href="data-processing.html#cb141-22" aria-hidden="true" tabindex="-1"></a>alternative hypothesis<span class="sc">:</span> true difference <span class="cf">in</span> means between group no and group yes is not equal to <span class="dv">0</span></span>
<span id="cb141-23"><a href="data-processing.html#cb141-23" aria-hidden="true" tabindex="-1"></a><span class="dv">95</span> percent confidence interval<span class="sc">:</span></span>
<span id="cb141-24"><a href="data-processing.html#cb141-24" aria-hidden="true" tabindex="-1"></a> <span class="sc">-</span><span class="fl">43.343346</span>   <span class="fl">1.643346</span></span>
<span id="cb141-25"><a href="data-processing.html#cb141-25" aria-hidden="true" tabindex="-1"></a>sample estimates<span class="sc">:</span></span>
<span id="cb141-26"><a href="data-processing.html#cb141-26" aria-hidden="true" tabindex="-1"></a> mean <span class="cf">in</span> group no mean <span class="cf">in</span> group yes </span>
<span id="cb141-27"><a href="data-processing.html#cb141-27" aria-hidden="true" tabindex="-1"></a>         <span class="fl">139.4167</span>          <span class="fl">160.2667</span> </span></code></pre></div>
<p>And we get a list with two elements, female and male, and each element is a t-test result. And we see a conventionally significant difference here for females, but not for the males.</p>
<p>Note that test results like these are relatively complicated R objects, so sapply is not going to do us much good here.</p>
<p>So the same thing works for regression, too: if we want to model systolic blood pressure as function of diastolic blood pressure for females and males separately, we use the same type of wrapping function, where we pass in the data argument to function lm. And if we look at the result, again a list of length two, and each is this the kind of very short summary we get for a linear regression object at the console, showing the call and the coefficients. Note that call looks the same for both elements, but the results are different, because x means different things for the two models.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="data-processing.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> split_lm <span class="ot">&lt;-</span> <span class="fu">lapply</span>(split_salt, <span class="cf">function</span>(x) <span class="fu">lm</span>(sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x))</span>
<span id="cb142-2"><a href="data-processing.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> split_lm</span>
<span id="cb142-3"><a href="data-processing.html#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb142-4"><a href="data-processing.html#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="data-processing.html#cb142-5" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb142-6"><a href="data-processing.html#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x)</span>
<span id="cb142-7"><a href="data-processing.html#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="data-processing.html#cb142-8" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb142-9"><a href="data-processing.html#cb142-9" aria-hidden="true" tabindex="-1"></a>(Intercept)          dbp  </span>
<span id="cb142-10"><a href="data-processing.html#cb142-10" aria-hidden="true" tabindex="-1"></a>      <span class="fl">11.63</span>         <span class="fl">1.45</span>  </span>
<span id="cb142-11"><a href="data-processing.html#cb142-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-12"><a href="data-processing.html#cb142-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-13"><a href="data-processing.html#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb142-14"><a href="data-processing.html#cb142-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-15"><a href="data-processing.html#cb142-15" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb142-16"><a href="data-processing.html#cb142-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x)</span>
<span id="cb142-17"><a href="data-processing.html#cb142-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-18"><a href="data-processing.html#cb142-18" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb142-19"><a href="data-processing.html#cb142-19" aria-hidden="true" tabindex="-1"></a>(Intercept)          dbp  </span>
<span id="cb142-20"><a href="data-processing.html#cb142-20" aria-hidden="true" tabindex="-1"></a>     <span class="sc">-</span><span class="fl">1.655</span>        <span class="fl">1.585</span>  </span></code></pre></div>
<p>No we can extract what we want to via lapply: e.g. a full summary for each model, with R2 and a regression table for each group. And indeed, we see rather similar slopes for both models, around 1.5, 1.6, both highly statistically significant, and rather different intercepts, which however not statistically significantly different from zero.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="data-processing.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_lm, summary)</span>
<span id="cb143-2"><a href="data-processing.html#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb143-3"><a href="data-processing.html#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="data-processing.html#cb143-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb143-5"><a href="data-processing.html#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x)</span>
<span id="cb143-6"><a href="data-processing.html#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-7"><a href="data-processing.html#cb143-7" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb143-8"><a href="data-processing.html#cb143-8" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb143-9"><a href="data-processing.html#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">42.271</span> <span class="sc">-</span><span class="fl">12.851</span>  <span class="sc">-</span><span class="fl">6.396</span>  <span class="fl">12.591</span>  <span class="fl">63.441</span> </span>
<span id="cb143-10"><a href="data-processing.html#cb143-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-11"><a href="data-processing.html#cb143-11" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb143-12"><a href="data-processing.html#cb143-12" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb143-13"><a href="data-processing.html#cb143-13" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">11.6308</span>    <span class="fl">12.5337</span>   <span class="fl">0.928</span>    <span class="fl">0.358</span>    </span>
<span id="cb143-14"><a href="data-processing.html#cb143-14" aria-hidden="true" tabindex="-1"></a>dbp           <span class="fl">1.4503</span>     <span class="fl">0.1206</span>  <span class="fl">12.025</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb143-15"><a href="data-processing.html#cb143-15" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb143-16"><a href="data-processing.html#cb143-16" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb143-17"><a href="data-processing.html#cb143-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-18"><a href="data-processing.html#cb143-18" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">22.61</span> on <span class="dv">53</span> degrees of freedom</span>
<span id="cb143-19"><a href="data-processing.html#cb143-19" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.7318</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.7267</span> </span>
<span id="cb143-20"><a href="data-processing.html#cb143-20" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">144.6</span> on <span class="dv">1</span> and <span class="dv">53</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span>
<span id="cb143-21"><a href="data-processing.html#cb143-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-22"><a href="data-processing.html#cb143-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-23"><a href="data-processing.html#cb143-23" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb143-24"><a href="data-processing.html#cb143-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-25"><a href="data-processing.html#cb143-25" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb143-26"><a href="data-processing.html#cb143-26" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> sbp <span class="sc">~</span> dbp, <span class="at">data =</span> x)</span>
<span id="cb143-27"><a href="data-processing.html#cb143-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-28"><a href="data-processing.html#cb143-28" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb143-29"><a href="data-processing.html#cb143-29" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb143-30"><a href="data-processing.html#cb143-30" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">34.091</span> <span class="sc">-</span><span class="fl">10.973</span>  <span class="sc">-</span><span class="fl">1.218</span>  <span class="fl">10.609</span>  <span class="fl">35.968</span> </span>
<span id="cb143-31"><a href="data-processing.html#cb143-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-32"><a href="data-processing.html#cb143-32" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb143-33"><a href="data-processing.html#cb143-33" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb143-34"><a href="data-processing.html#cb143-34" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="sc">-</span><span class="fl">1.6551</span>    <span class="fl">12.8944</span>  <span class="sc">-</span><span class="fl">0.128</span>    <span class="fl">0.898</span>    </span>
<span id="cb143-35"><a href="data-processing.html#cb143-35" aria-hidden="true" tabindex="-1"></a>dbp           <span class="fl">1.5850</span>     <span class="fl">0.1323</span>  <span class="fl">11.983</span> <span class="fl">2.71e-15</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb143-36"><a href="data-processing.html#cb143-36" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb143-37"><a href="data-processing.html#cb143-37" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb143-38"><a href="data-processing.html#cb143-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-39"><a href="data-processing.html#cb143-39" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">16.42</span> on <span class="dv">43</span> degrees of freedom</span>
<span id="cb143-40"><a href="data-processing.html#cb143-40" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.7695</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.7642</span> </span>
<span id="cb143-41"><a href="data-processing.html#cb143-41" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">143.6</span> on <span class="dv">1</span> and <span class="dv">43</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">2.707e-15</span></span></code></pre></div>
<p>We can run an Anova for each model, or just extract the coefficients, either as list or simplified. Or we can just extract the slopes, again simplified, here to a vector.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="data-processing.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_lm, anova)</span>
<span id="cb144-2"><a href="data-processing.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb144-3"><a href="data-processing.html#cb144-3" aria-hidden="true" tabindex="-1"></a>Analysis of Variance Table</span>
<span id="cb144-4"><a href="data-processing.html#cb144-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-5"><a href="data-processing.html#cb144-5" aria-hidden="true" tabindex="-1"></a>Response<span class="sc">:</span> sbp</span>
<span id="cb144-6"><a href="data-processing.html#cb144-6" aria-hidden="true" tabindex="-1"></a>          Df Sum Sq Mean Sq F value    <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)    </span>
<span id="cb144-7"><a href="data-processing.html#cb144-7" aria-hidden="true" tabindex="-1"></a>dbp        <span class="dv">1</span>  <span class="dv">73899</span>   <span class="dv">73899</span>  <span class="fl">144.59</span> <span class="sc">&lt;</span> <span class="fl">2.2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb144-8"><a href="data-processing.html#cb144-8" aria-hidden="true" tabindex="-1"></a>Residuals <span class="dv">53</span>  <span class="dv">27088</span>     <span class="dv">511</span>                      </span>
<span id="cb144-9"><a href="data-processing.html#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb144-10"><a href="data-processing.html#cb144-10" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb144-11"><a href="data-processing.html#cb144-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-12"><a href="data-processing.html#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb144-13"><a href="data-processing.html#cb144-13" aria-hidden="true" tabindex="-1"></a>Analysis of Variance Table</span>
<span id="cb144-14"><a href="data-processing.html#cb144-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-15"><a href="data-processing.html#cb144-15" aria-hidden="true" tabindex="-1"></a>Response<span class="sc">:</span> sbp</span>
<span id="cb144-16"><a href="data-processing.html#cb144-16" aria-hidden="true" tabindex="-1"></a>          Df Sum Sq Mean Sq F value    <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)    </span>
<span id="cb144-17"><a href="data-processing.html#cb144-17" aria-hidden="true" tabindex="-1"></a>dbp        <span class="dv">1</span>  <span class="dv">38720</span>   <span class="dv">38720</span>  <span class="fl">143.59</span> <span class="fl">2.707e-15</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb144-18"><a href="data-processing.html#cb144-18" aria-hidden="true" tabindex="-1"></a>Residuals <span class="dv">43</span>  <span class="dv">11596</span>     <span class="dv">270</span>                      </span>
<span id="cb144-19"><a href="data-processing.html#cb144-19" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb144-20"><a href="data-processing.html#cb144-20" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb144-21"><a href="data-processing.html#cb144-21" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(split_lm, coef)</span>
<span id="cb144-22"><a href="data-processing.html#cb144-22" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>female</span>
<span id="cb144-23"><a href="data-processing.html#cb144-23" aria-hidden="true" tabindex="-1"></a>(Intercept)         dbp </span>
<span id="cb144-24"><a href="data-processing.html#cb144-24" aria-hidden="true" tabindex="-1"></a>  <span class="fl">11.630812</span>    <span class="fl">1.450272</span> </span>
<span id="cb144-25"><a href="data-processing.html#cb144-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-26"><a href="data-processing.html#cb144-26" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>male</span>
<span id="cb144-27"><a href="data-processing.html#cb144-27" aria-hidden="true" tabindex="-1"></a>(Intercept)         dbp </span>
<span id="cb144-28"><a href="data-processing.html#cb144-28" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">1.655092</span>    <span class="fl">1.584973</span> </span>
<span id="cb144-29"><a href="data-processing.html#cb144-29" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sapply</span>(split_lm, coef)</span>
<span id="cb144-30"><a href="data-processing.html#cb144-30" aria-hidden="true" tabindex="-1"></a>               female      male</span>
<span id="cb144-31"><a href="data-processing.html#cb144-31" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">11.630812</span> <span class="sc">-</span><span class="fl">1.655092</span></span>
<span id="cb144-32"><a href="data-processing.html#cb144-32" aria-hidden="true" tabindex="-1"></a>dbp          <span class="fl">1.450272</span>  <span class="fl">1.584973</span></span>
<span id="cb144-33"><a href="data-processing.html#cb144-33" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb144-34"><a href="data-processing.html#cb144-34" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># Extract specific element: slope of line</span></span>
<span id="cb144-35"><a href="data-processing.html#cb144-35" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">sapply</span>(split_lm, <span class="cf">function</span>(x) <span class="fu">coef</span>(x)[<span class="dv">2</span>])</span>
<span id="cb144-36"><a href="data-processing.html#cb144-36" aria-hidden="true" tabindex="-1"></a>female.dbp   male.dbp </span>
<span id="cb144-37"><a href="data-processing.html#cb144-37" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.450272</span>   <span class="fl">1.584973</span> </span></code></pre></div>
</div>
<div id="merging-data-sets" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Merging data sets</h2>
<p>So far, we have had all our data conveniently in one large data frame, with all variables and subjects of interest. Hoever, this is rarely how data starts out. A typical register study in epidemiology for example will have several different sources of data, say for example the cancer register, the patient register, and the drug prescription registers. And one of the first steps in the pre-processing is combining all that information.</p>
<p>And how this is done is by merging the data from different sources, based on some unique identifier in the data. For Swedish registers, this will generally be the personal identification number (PID, Swedish <em>personnummer</em>), or some pseudonymized version thereof (usually a sequential identification number, or running number, Swedish <em>löpnummer</em>). So conceptually this is simple, just start merging two tables, and keep merging until all the required data resides in a table ready for analysis.</p>
<p>So how do you merge two tables? Well, base R has the merge-function. It’s not extremely fast, and has an interface that is a bit special, but it does the trick. Of course, there are subtle variants for how exactly you can merge data, so let’s look at an example.</p>
<p>Going back to the salt data, this was actually collected at different health centers. This information is not part of the original data, but I happen to have an extra data file with the health centers. I can read this in as usually, using the read.delim function. Looking at the data via summary, I see that there are two variables, one with IDs and one with the center information, one of A, B or C. And I notice that there are more subjects with ID information, definitely more than a 100, which is what we have in the basic salt data. And these two data frames are not even remotely in the same order either, looking at the IDs here.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="data-processing.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> centers <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">&quot;Data/center_saltadd.txt&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb145-2"><a href="data-processing.html#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(centers)</span>
<span id="cb145-3"><a href="data-processing.html#cb145-3" aria-hidden="true" tabindex="-1"></a>       ID       Center</span>
<span id="cb145-4"><a href="data-processing.html#cb145-4" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="dv">1006</span>   A<span class="sc">:</span><span class="dv">56</span>  </span>
<span id="cb145-5"><a href="data-processing.html#cb145-5" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="dv">2787</span>   B<span class="sc">:</span><span class="dv">57</span>  </span>
<span id="cb145-6"><a href="data-processing.html#cb145-6" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="dv">5527</span>   C<span class="sc">:</span><span class="dv">37</span>  </span>
<span id="cb145-7"><a href="data-processing.html#cb145-7" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="dv">5367</span>         </span>
<span id="cb145-8"><a href="data-processing.html#cb145-8" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="dv">7754</span>         </span>
<span id="cb145-9"><a href="data-processing.html#cb145-9" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="dv">9962</span>         </span>
<span id="cb145-10"><a href="data-processing.html#cb145-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> centers[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, ]</span>
<span id="cb145-11"><a href="data-processing.html#cb145-11" aria-hidden="true" tabindex="-1"></a>    ID Center</span>
<span id="cb145-12"><a href="data-processing.html#cb145-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1006</span>      A</span>
<span id="cb145-13"><a href="data-processing.html#cb145-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1086</span>      A</span>
<span id="cb145-14"><a href="data-processing.html#cb145-14" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1219</span>      A</span>
<span id="cb145-15"><a href="data-processing.html#cb145-15" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1265</span>      A</span>
<span id="cb145-16"><a href="data-processing.html#cb145-16" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1457</span>      A</span>
<span id="cb145-17"><a href="data-processing.html#cb145-17" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1458</span>      A</span>
<span id="cb145-18"><a href="data-processing.html#cb145-18" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span> <span class="dv">1514</span>      A</span>
<span id="cb145-19"><a href="data-processing.html#cb145-19" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> <span class="dv">1678</span>      A</span>
<span id="cb145-20"><a href="data-processing.html#cb145-20" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> salt_ht[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, ]</span>
<span id="cb145-21"><a href="data-processing.html#cb145-21" aria-hidden="true" tabindex="-1"></a>    ID    sex sbp dbp saltadd age</span>
<span id="cb145-22"><a href="data-processing.html#cb145-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">4305</span>   male <span class="dv">110</span>  <span class="dv">80</span>     yes  <span class="dv">58</span></span>
<span id="cb145-23"><a href="data-processing.html#cb145-23" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">6606</span> female  <span class="dv">85</span>  <span class="dv">55</span>      no  <span class="dv">32</span></span>
<span id="cb145-24"><a href="data-processing.html#cb145-24" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">5758</span> female <span class="dv">196</span> <span class="dv">128</span>    <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">53</span></span>
<span id="cb145-25"><a href="data-processing.html#cb145-25" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">2265</span>   male <span class="dv">167</span> <span class="dv">112</span>     yes  <span class="dv">68</span></span>
<span id="cb145-26"><a href="data-processing.html#cb145-26" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">7408</span> female <span class="dv">145</span> <span class="dv">110</span>     yes  <span class="dv">55</span></span>
<span id="cb145-27"><a href="data-processing.html#cb145-27" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">2160</span> female <span class="dv">179</span> <span class="dv">120</span>      no  <span class="dv">60</span></span>
<span id="cb145-28"><a href="data-processing.html#cb145-28" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span> <span class="dv">8846</span>   male <span class="dv">111</span>  <span class="dv">78</span>      no  <span class="dv">59</span></span>
<span id="cb145-29"><a href="data-processing.html#cb145-29" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> <span class="dv">8202</span> female <span class="dv">110</span>  <span class="dv">70</span>      no  <span class="dv">32</span></span></code></pre></div>
<p>In a first step, we want to see how many individuals in the original salt data also have information on the health center. We can do this via the function <code>setdiff</code>, which takes as arguments two vectors, and returns the vector of all elements which are in the first, but not the second vector.<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="data-processing.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">setdiff</span>(salt_ht<span class="sc">$</span>ID, centers<span class="sc">$</span>ID)</span>
<span id="cb146-2"><a href="data-processing.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">integer</span>(<span class="dv">0</span>)</span>
<span id="cb146-3"><a href="data-processing.html#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">setdiff</span>(centers<span class="sc">$</span>ID, salt_ht<span class="sc">$</span>ID)</span>
<span id="cb146-4"><a href="data-processing.html#cb146-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">1265</span> <span class="dv">1458</span> <span class="dv">1514</span> <span class="dv">1678</span> <span class="dv">2769</span> <span class="dv">3388</span> <span class="dv">3678</span> <span class="dv">3966</span> <span class="dv">5723</span> <span class="dv">6358</span> <span class="dv">6911</span> <span class="dv">7076</span> <span class="dv">7228</span> <span class="dv">7689</span> <span class="dv">8129</span></span>
<span id="cb146-5"><a href="data-processing.html#cb146-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">16</span>] <span class="dv">8396</span> <span class="dv">8990</span> <span class="dv">9113</span> <span class="dv">9469</span> <span class="dv">9470</span> <span class="dv">9490</span> <span class="dv">9943</span> <span class="dv">9949</span> <span class="dv">1014</span> <span class="dv">1162</span> <span class="dv">1533</span> <span class="dv">1670</span> <span class="dv">1700</span> <span class="dv">1938</span> <span class="dv">2621</span></span>
<span id="cb146-6"><a href="data-processing.html#cb146-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">31</span>] <span class="dv">3117</span> <span class="dv">3597</span> <span class="dv">3762</span> <span class="dv">4346</span> <span class="dv">5520</span> <span class="dv">5764</span> <span class="dv">5791</span> <span class="dv">7915</span> <span class="dv">8069</span> <span class="dv">8179</span> <span class="dv">8993</span> <span class="dv">9226</span> <span class="dv">9580</span> <span class="dv">9754</span> <span class="dv">2304</span></span>
<span id="cb146-7"><a href="data-processing.html#cb146-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">46</span>] <span class="dv">2523</span> <span class="dv">5070</span> <span class="dv">6210</span> <span class="dv">8023</span> <span class="dv">9358</span></span></code></pre></div>
<p>We see that subtracting the identifiers in the center-data from the identifiers in the original salt study returns a vector of length zero, as in, there is no subject left for whom we do not have information on the center in the second data set. However, flipping this, subtracting the original salt data IDs from the center IDs, we get a non-zero vector of subject IDs for which we have center information, but none of the blood pressure- or demographic variables. We can use the guides in the console to count that there must be 50 of those.</p>
<p>This means that we can augment our original data set, by adding the center variable to salt_ht, because there is center information for all subjects in salt_ht. In database language, this is known as a <em>left join</em>, and we can do this using merge as follows:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="data-processing.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> salt_ht_centers <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> salt_ht, <span class="at">y =</span> centers, <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">all.y =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We specify salt_ht as the first data set (argument <code>x</code>), and the center data set as second argument (<code>y</code>). Then, we tell the function which column holds the identifier, which in this case is column <code>ID</code> in both data frames; and then we decide what is kept and what is dropped: by setting <code>all.x = TRUE</code>, we state that we want all rows in <code>x</code>, that is <code>salt_ht</code>, to appear in the result. At the same time, we set <code>all.y = FALSE</code>, thereby stating that all rows of <code>y</code> (the center data) which have no match in <code>x</code>, should be dropped from the result.</p>
<p>For this combination of <code>all.x</code> and <code>all.y</code>, the result should be a data frame with the same number of rows as <code>salt_ht</code>, but extra columns from <code>centers</code>. And this works, as we see here from the summary: we still have 55 women and 45 men, but we also have the extra variable Center, which breaks down roughly equally across <code>A</code>, <code>B</code> and <code>C</code>. And a quick check of the top of the data looks ok, too.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="data-processing.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(salt_ht_centers)</span>
<span id="cb148-2"><a href="data-processing.html#cb148-2" aria-hidden="true" tabindex="-1"></a>       ID           sex          sbp             dbp         saltadd  </span>
<span id="cb148-3"><a href="data-processing.html#cb148-3" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="dv">1006</span>   female<span class="sc">:</span><span class="dv">55</span>   Min.   <span class="sc">:</span> <span class="fl">80.0</span>   Min.   <span class="sc">:</span> <span class="fl">55.00</span>   no  <span class="sc">:</span><span class="dv">37</span>  </span>
<span id="cb148-4"><a href="data-processing.html#cb148-4" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="dv">2879</span>   male  <span class="sc">:</span><span class="dv">45</span>   1st Qu.<span class="sc">:</span><span class="fl">121.0</span>   1st Qu.<span class="sc">:</span> <span class="fl">80.00</span>   yes <span class="sc">:</span><span class="dv">43</span>  </span>
<span id="cb148-5"><a href="data-processing.html#cb148-5" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="dv">5237</span>               Median <span class="sc">:</span><span class="fl">148.5</span>   Median <span class="sc">:</span> <span class="fl">96.00</span>   NA<span class="st">&#39;s:20  </span></span>
<span id="cb148-6"><a href="data-processing.html#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="st"> Mean   :5227               Mean   :154.3   Mean   : 98.51            </span></span>
<span id="cb148-7"><a href="data-processing.html#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="st"> 3rd Qu.:7309               3rd Qu.:184.0   3rd Qu.:116.25            </span></span>
<span id="cb148-8"><a href="data-processing.html#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="st"> Max.   :9962               Max.   :238.0   Max.   :158.00            </span></span>
<span id="cb148-9"><a href="data-processing.html#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="st">      age        Center</span></span>
<span id="cb148-10"><a href="data-processing.html#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="st"> Min.   :26.00   A:33  </span></span>
<span id="cb148-11"><a href="data-processing.html#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="st"> 1st Qu.:39.75   B:36  </span></span>
<span id="cb148-12"><a href="data-processing.html#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="st"> Median :50.00   C:31  </span></span>
<span id="cb148-13"><a href="data-processing.html#cb148-13" aria-hidden="true" tabindex="-1"></a><span class="st"> Mean   :48.71         </span></span>
<span id="cb148-14"><a href="data-processing.html#cb148-14" aria-hidden="true" tabindex="-1"></a><span class="st"> 3rd Qu.:58.00         </span></span>
<span id="cb148-15"><a href="data-processing.html#cb148-15" aria-hidden="true" tabindex="-1"></a><span class="st"> Max.   :71.00         </span></span>
<span id="cb148-16"><a href="data-processing.html#cb148-16" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; salt_ht_centers[1:10, ]</span></span>
<span id="cb148-17"><a href="data-processing.html#cb148-17" aria-hidden="true" tabindex="-1"></a><span class="st">     ID    sex sbp dbp saltadd age Center</span></span>
<span id="cb148-18"><a href="data-processing.html#cb148-18" aria-hidden="true" tabindex="-1"></a><span class="st">1  1006   male 192 118      no  42      A</span></span>
<span id="cb148-19"><a href="data-processing.html#cb148-19" aria-hidden="true" tabindex="-1"></a><span class="st">2  1024 female 178 128     yes  63      C</span></span>
<span id="cb148-20"><a href="data-processing.html#cb148-20" aria-hidden="true" tabindex="-1"></a><span class="st">3  1086 female 160 108     yes  47      A</span></span>
<span id="cb148-21"><a href="data-processing.html#cb148-21" aria-hidden="true" tabindex="-1"></a><span class="st">4  1219 female 148 108     yes  55      A</span></span>
<span id="cb148-22"><a href="data-processing.html#cb148-22" aria-hidden="true" tabindex="-1"></a><span class="st">5  1457   male 170  98      no  66      A</span></span>
<span id="cb148-23"><a href="data-processing.html#cb148-23" aria-hidden="true" tabindex="-1"></a><span class="st">6  1511 female 149  94      no  48      B</span></span>
<span id="cb148-24"><a href="data-processing.html#cb148-24" aria-hidden="true" tabindex="-1"></a><span class="st">7  1598   male 118  72      no  52      B</span></span>
<span id="cb148-25"><a href="data-processing.html#cb148-25" aria-hidden="true" tabindex="-1"></a><span class="st">8  1635 female 115  73     yes  40      C</span></span>
<span id="cb148-26"><a href="data-processing.html#cb148-26" aria-hidden="true" tabindex="-1"></a><span class="st">9  1640   male 171 105     yes  53      B</span></span>
<span id="cb148-27"><a href="data-processing.html#cb148-27" aria-hidden="true" tabindex="-1"></a><span class="st">10 1684   male 184  98    &lt;NA&gt;  58      B</span></span></code></pre></div>
<p>In contrast, we can request that all rows from both data sets are kept in the resulting data frame, simply by setting <code>all.y = TRUE</code>. If we look at the resulting data frame, we have the same columns (including <code>Center</code>) as before, but now also have missing values for all variables except <code>ID</code> and <code>Center</code>: these are precisely new 50 missing values in the blood pressure- and demographic variables fro subjects who are part of <code>salt_ht</code>, but not <code>centers</code>. This kind of merging known as a <em>full</em> or <em>outer</em> join.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="data-processing.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> salt_ht_centers_all <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> salt_ht, <span class="at">y =</span> centers, <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-2"><a href="data-processing.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(salt_ht_centers_all)</span>
<span id="cb149-3"><a href="data-processing.html#cb149-3" aria-hidden="true" tabindex="-1"></a>       ID           sex          sbp             dbp         saltadd  </span>
<span id="cb149-4"><a href="data-processing.html#cb149-4" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="dv">1006</span>   female<span class="sc">:</span><span class="dv">55</span>   Min.   <span class="sc">:</span> <span class="fl">80.0</span>   Min.   <span class="sc">:</span> <span class="fl">55.00</span>   no  <span class="sc">:</span><span class="dv">37</span>  </span>
<span id="cb149-5"><a href="data-processing.html#cb149-5" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="dv">2787</span>   male  <span class="sc">:</span><span class="dv">45</span>   1st Qu.<span class="sc">:</span><span class="fl">121.0</span>   1st Qu.<span class="sc">:</span> <span class="fl">80.00</span>   yes <span class="sc">:</span><span class="dv">43</span>  </span>
<span id="cb149-6"><a href="data-processing.html#cb149-6" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="dv">5527</span>   NA<span class="st">&#39;s  :50   Median :148.5   Median : 96.00   NA&#39;</span>s<span class="sc">:</span><span class="dv">70</span>  </span>
<span id="cb149-7"><a href="data-processing.html#cb149-7" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="dv">5367</span>               Mean   <span class="sc">:</span><span class="fl">154.3</span>   Mean   <span class="sc">:</span> <span class="fl">98.51</span>            </span>
<span id="cb149-8"><a href="data-processing.html#cb149-8" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="dv">7754</span>               3rd Qu.<span class="sc">:</span><span class="fl">184.0</span>   3rd Qu.<span class="sc">:</span><span class="fl">116.25</span>            </span>
<span id="cb149-9"><a href="data-processing.html#cb149-9" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="dv">9962</span>               Max.   <span class="sc">:</span><span class="fl">238.0</span>   Max.   <span class="sc">:</span><span class="fl">158.00</span>            </span>
<span id="cb149-10"><a href="data-processing.html#cb149-10" aria-hidden="true" tabindex="-1"></a>                            NA<span class="st">&#39;s   :50      NA&#39;</span>s   <span class="sc">:</span><span class="dv">50</span>                </span>
<span id="cb149-11"><a href="data-processing.html#cb149-11" aria-hidden="true" tabindex="-1"></a>      age        Center</span>
<span id="cb149-12"><a href="data-processing.html#cb149-12" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="fl">26.00</span>   A<span class="sc">:</span><span class="dv">56</span>  </span>
<span id="cb149-13"><a href="data-processing.html#cb149-13" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="fl">39.75</span>   B<span class="sc">:</span><span class="dv">57</span>  </span>
<span id="cb149-14"><a href="data-processing.html#cb149-14" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="fl">50.00</span>   C<span class="sc">:</span><span class="dv">37</span>  </span>
<span id="cb149-15"><a href="data-processing.html#cb149-15" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="fl">48.71</span>         </span>
<span id="cb149-16"><a href="data-processing.html#cb149-16" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="fl">58.00</span>         </span>
<span id="cb149-17"><a href="data-processing.html#cb149-17" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="fl">71.00</span>         </span>
<span id="cb149-18"><a href="data-processing.html#cb149-18" aria-hidden="true" tabindex="-1"></a> NA<span class="st">&#39;s   :50            </span></span>
<span id="cb149-19"><a href="data-processing.html#cb149-19" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; salt_ht_centers_all[1:10, ]</span></span>
<span id="cb149-20"><a href="data-processing.html#cb149-20" aria-hidden="true" tabindex="-1"></a><span class="st">     ID    sex sbp dbp saltadd age Center</span></span>
<span id="cb149-21"><a href="data-processing.html#cb149-21" aria-hidden="true" tabindex="-1"></a><span class="st">1  1006   male 192 118      no  42      A</span></span>
<span id="cb149-22"><a href="data-processing.html#cb149-22" aria-hidden="true" tabindex="-1"></a><span class="st">2  1014   &lt;NA&gt;  NA  NA    &lt;NA&gt;  NA      B</span></span>
<span id="cb149-23"><a href="data-processing.html#cb149-23" aria-hidden="true" tabindex="-1"></a><span class="st">3  1024 female 178 128     yes  63      C</span></span>
<span id="cb149-24"><a href="data-processing.html#cb149-24" aria-hidden="true" tabindex="-1"></a><span class="st">4  1086 female 160 108     yes  47      A</span></span>
<span id="cb149-25"><a href="data-processing.html#cb149-25" aria-hidden="true" tabindex="-1"></a><span class="st">5  1162   &lt;NA&gt;  NA  NA    &lt;NA&gt;  NA      B</span></span>
<span id="cb149-26"><a href="data-processing.html#cb149-26" aria-hidden="true" tabindex="-1"></a><span class="st">6  1219 female 148 108     yes  55      A</span></span>
<span id="cb149-27"><a href="data-processing.html#cb149-27" aria-hidden="true" tabindex="-1"></a><span class="st">7  1265   &lt;NA&gt;  NA  NA    &lt;NA&gt;  NA      A</span></span>
<span id="cb149-28"><a href="data-processing.html#cb149-28" aria-hidden="true" tabindex="-1"></a><span class="st">8  1457   male 170  98      no  66      A</span></span>
<span id="cb149-29"><a href="data-processing.html#cb149-29" aria-hidden="true" tabindex="-1"></a><span class="st">9  1458   &lt;NA&gt;  NA  NA    &lt;NA&gt;  NA      A</span></span>
<span id="cb149-30"><a href="data-processing.html#cb149-30" aria-hidden="true" tabindex="-1"></a><span class="st">10 1511 female 149  94      no  48      B</span></span></code></pre></div>
</div>
<div id="using-pipelines" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Using pipelines</h2>
<p>UNDER CONSTRUCTION</p>
</div>
<div id="technical-notes-1" class="section level2" number="6.7">
<h2><span class="header-section-number">6.7</span> Technical notes</h2>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="14">
<li id="fn14"><p>Note that <code>aggregate</code> returns a data frame, so this in this example, we have a data frame with two rows and four columns. As you would expect, you can save this data frame as an object, and use the aggreated results in your downstream analysis.<a href="data-processing.html#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>Actually, <code>cbind</code> returns a matrix, see section FIXME.<a href="data-processing.html#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p>This is called a <em>named vector</em>, and works quite similar to named lists we have already discussed: we can still use the basic indexing methods (by position, logical), but we can also use the names to reference elements of the vector. We have already seen examples of named vectors without knowing it, namely the result of calling <code>summary</code> for a basic vector. FIXME: example?<a href="data-processing.html#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p><code>setdiff</code> stands for <em>set difference</em>, as in, subtract the elements of the second vector from the first one.<a href="data-processing.html#fnref18" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-types-struct.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-tidyverse.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/data_processing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["introductio-to-r.pdf", "introductio-to-r.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
